<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="精神小伙" href="https://junwide.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" title="精神小伙" href="https://junwide.github.io/atom.xml"><link rel="alternate" type="application/json" title="精神小伙" href="https://junwide.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="Linux,优化"><link rel="canonical" href="https://junwide.github.io/Linux-Basic/Linux%20%E8%A7%A3%E5%AF%86%E2%80%94CPU%E5%88%A9%E7%94%A8%E7%8E%87/"><title>Linux 解密—CPU利用率 - Linux基础 | Brain Home = 精神小伙 = Tech.&Mem.</title><meta name="generator" content="Hexo 5.4.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">Linux 解密—CPU利用率</h1><div class="meta"><span class="item" title="创建时间：2021-02-25 12:00:00"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2021-02-25T12:00:00+08:00">2021-02-25</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>4.5k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>8 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Brain Home</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://gitee.com/junwide/blog/raw/master/20210418104528.jpg"></li><li class="item" data-background-image="https://gitee.com/junwide/blog/raw/master/20210418104513.jpg"></li><li class="item" data-background-image="https://gitee.com/junwide/blog/raw/master/20210418104617.jpg"></li><li class="item" data-background-image="https://gitee.com/junwide/blog/raw/master/20210418104434.jpg"></li><li class="item" data-background-image="https://gitee.com/junwide/blog/raw/master/20210418104415.jpg"></li><li class="item" data-background-image="https://gitee.com/junwide/blog/raw/master/20210418104627.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/linux-basic/" itemprop="item" rel="index" title="分类于 Linux基础"><span itemprop="name">Linux基础</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://junwide.github.io/Linux-Basic/Linux%20%E8%A7%A3%E5%AF%86%E2%80%94CPU%E5%88%A9%E7%94%A8%E7%8E%87/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Junwide Xiao"><meta itemprop="description" content="Tech.&Mem., 生活与技术"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="精神小伙"></span><div class="body md" itemprop="articleBody"><h1 id="linux-解密cpu利用率"><a class="anchor" href="#linux-解密cpu利用率">#</a> Linux 解密 —CPU 利用率</h1><p><img data-src="https://gitee.com/junwide/blog/raw/master/20210225213502.png" alt="image-20210225213454924"></p><hr><p><strong>Goal</strong></p><ul><li><p>🔲什么是 CPU 的利用率</p></li><li><p>🔲IPC 是什么</p></li><li><p>🔲如何获取真正的 CPU 瓶颈根源</p></li></ul><p><strong>Preconditions</strong></p><ul><li><p>✅了解 CPU</p></li><li><p>✅了解计算机</p></li><li><p>✅了解 Linux 的基本使用</p></li></ul><h2 id="what-s-the-cpu-utilization"><a class="anchor" href="#what-s-the-cpu-utilization">#</a> What ‘s the CPU Utilization</h2><p>CPU 的时间由两部分组成：</p><ul><li>一是 CPU 用于处理程序指令或者操作系统指令的时间，也称之为 <code>busy time</code></li><li>二是 CPU 等待 I/O 操作或者进入 <code>idle mode</code> （也就是空闲线程模式） 的时间，也称之为 <code>idle time</code></li></ul><p>CPU 利用率：指的是 CPU 用于处理程序指令或者操作系统指令的时间占总时间的百分比</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>C</mi><mi>P</mi><msub><mi>U</mi><mrow><mi>U</mi><mi>t</mi><mi>i</mi><mi>l</mi><mi>i</mi><mi>z</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow></msub><mo>=</mo><mfrac><msub><mi>T</mi><mrow><mi>b</mi><mi>u</mi><mi>s</mi><mi>y</mi></mrow></msub><mrow><msub><mi>T</mi><mrow><mi>b</mi><mi>u</mi><mi>s</mi><mi>y</mi></mrow></msub><mo>+</mo><msub><mi>T</mi><mrow><mi>i</mi><mi>d</mi><mi>l</mi><mi>e</mi></mrow></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">CPU_{ Utilization} = \frac{T_{busy}}{T_{busy}+T_{idle}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.83333em;vertical-align:-.15em"></span><span class="mord mathnormal" style="margin-right:.07153em">C</span><span class="mord mathnormal" style="margin-right:.13889em">P</span><span class="mord"><span class="mord mathnormal" style="margin-right:.10903em">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.33610799999999996em"><span style="top:-2.5500000000000003em;margin-left:-.10903em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.10903em">U</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:.01968em">l</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:.04398em">z</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:2.332438em;vertical-align:-.972108em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3361079999999999em"><span style="top:-2.5500000000000003em;margin-left:-.13889em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">b</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight" style="margin-right:.03588em">y</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.286108em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.33610799999999996em"><span style="top:-2.5500000000000003em;margin-left:-.13889em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight" style="margin-right:.01968em">l</span><span class="mord mathnormal mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3361079999999999em"><span style="top:-2.5500000000000003em;margin-left:-.13889em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">b</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight" style="margin-right:.03588em">y</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.286108em"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.972108em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>CPU 使用率有两个主要用途</p><ol><li>是量化系统的整体繁忙度。<ul><li>当 CPU 使用率很高时，用户可能会遇到延迟。如此高的 CPU 使用率表明处理能力不足。</li><li>解决方法：要么需要升级 CPU，要么通过减少任务负载来使得整体体验回复。</li></ul></li><li>是更好让程序共享处理器。<ul><li>在多任务系统中，如果单个程序的 CPU 使用率过高可能表明它对处理能力的要求很高，或者可能会发生故障（进入死循环）。</li><li>解决方法：测量单个程序在设置的时间内的利用率，如果处在异常高的值，则触发 <code>trap</code> 然后进行任务调度。</li></ul></li></ol><blockquote><p>From: Wiki CPU Time</p><p><strong>CPU time</strong> (or <strong>process time</strong>) is the amount of time for which a CPU was used for processing instructions of a computer program or operating system, as opposed to elapsed time, which includes for example, waiting for I/O operations or entering low-power (idle) mode. The CPU time is measured in clock ticks or seconds. Often, it is useful to measure CPU time as a percentage of the CPU's capacity, which is called the <strong>CPU usage</strong>.</p><p>CPU time and CPU usage have two main uses. The first use is to quantify the overall busyness of the system. When the CPU usage is high, the user may experience lag. Such high CPU usage indicates insufficient processing power. Either the CPU needs to be upgraded, or the user experience reduced, for example, by switching to lower resolution graphics or reducing animations.</p></blockquote><h2 id="how-to-measure"><a class="anchor" href="#how-to-measure">#</a> How to measure</h2><p>常用的工具有 <code>top</code> ， <code>ps</code> ， <code>htop</code> 等</p><p><code>ps</code> ：静态查看的进程状态的工具</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>$ <span class="token function">ps</span> -aux</pre></td></tr></table></figure><p><img data-src="https://gitee.com/junwide/blog/raw/master/20210227212318.png" alt="image-20210227212318567"></p><blockquote><p><code>%CPU</code> ：就是程序对 CPU 的占用率，总和就是我们的 CPU 的利用率，这里我们看到总和为 0.9%</p></blockquote><p><code>top</code> ：动态查看进程状态的工具</p><p><img data-src="https://gitee.com/junwide/blog/raw/master/20210227212939.png" alt="image-20210227212939643"></p><p><code>htop</code> ：高亮可视化的查看进程状态的工具</p><p><img data-src="https://gitee.com/junwide/blog/raw/master/20210227212622.png" alt="image-20210227212622081"></p><h2 id="it-is-true"><a class="anchor" href="#it-is-true">#</a> It is True？</h2><p>然而我们需要仔细思考这个问题，CPU 利用率这个指标真的能来衡量性能的发挥吗？如果 CPU 利用率处于一个较高水平，是否意味着性能瓶颈在别的地方呢？我们来看个例子，我们使用 <code>Top</code> 获取的信息：</p><p><img data-src="https://gitee.com/junwide/blog/raw/master/20210225232159.png" alt="img"></p><p>你可能会认为 90％的 CPU 利用率意味着：CPU 百分之九十的时间都在忙！</p><p>然而他可能是这个样子：</p><p><a target="_blank" rel="noopener" href="http://www.brendangregg.com/blog/images/2017/cpubusystalledidle.png"><img data-src="https://gitee.com/junwide/blog/raw/master/20210225231816.png" alt="img"></a></p><p>CPU 只有一部分时间在忙，而其他时间在 <code>Waiting</code></p><p><code>Waiting</code> 表示处理器并没有在处理指令，因为它通常是正在等待内存 I/O。这意味着什么？了解您的 CPU <code>Waiting</code> 了多少，可以在减少指令或者减少内存 I/O 之间进行性能调整。</p><p>我们称为 CPU 利用率的指标实际上是 “非空闲时间”，如今，CPU 的速度已经比主内存快得多，而等待内存的问题仍然严重。当您在 <code>top</code> 中看到较高的 <code>％CPU</code> 时，你可能会认为瓶颈是 CPU，而实际上却是 DRAM</p><p>长期以来，CPU 制造商的时钟速度扩展速度比 DRAM 扩展其访问延迟速度要快。同时 CPU 使用更多的内核和超线程进行扩展，再加上多插槽配置，所有这些都对存储子系统提出了更高的要求。CPU 制造商已尝试通过更大更智能的 CPU Cache 以及更快的内存总线和互连来减少内存瓶颈。</p><h2 id="back-to-definition"><a class="anchor" href="#back-to-definition">#</a> Back to Definition</h2><p>从上面的问题我们可以发现，CPU 利用率无法真正告诉我们 CPU 的有效利用率是多少，他只是能告知 CPU 是否处于工作，而很有可能他此刻正在” 摸鱼 “，而造成这个问题的根本在于内存的” 偷懒 “。那么我们应该如何获取真正 CPU 的利用率呢？或者如果知道 CPU 是否在” 摸鱼 “？</p><p>回答这个问题，其实很简单，我们只需要了解 CPU 他最本质的工作定义：便是执行计算机的指令。</p><p>那么我们由此就能有以下的定义：<br>每条指令的平均周期 CPI:</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>C</mi><mi>P</mi><mi>I</mi><mo>=</mo><mfrac><mn>1</mn><mi>I</mi></mfrac></mrow><annotation encoding="application/x-tex">CPI = \frac{1}{I}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.68333em;vertical-align:0"></span><span class="mord mathnormal" style="margin-right:.07153em">C</span><span class="mord mathnormal" style="margin-right:.13889em">P</span><span class="mord mathnormal" style="margin-right:.07847em">I</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:2.00744em;vertical-align:-.686em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.07847em">I</span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.686em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>每个周期的平均指令 IPC:</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>I</mi><mi>P</mi><mi>C</mi><mo>=</mo><mfrac><mn>1</mn><mi>C</mi></mfrac></mrow><annotation encoding="application/x-tex">IPC = \frac{1}{C}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.68333em;vertical-align:0"></span><span class="mord mathnormal" style="margin-right:.07847em">I</span><span class="mord mathnormal" style="margin-right:.13889em">P</span><span class="mord mathnormal" style="margin-right:.07153em">C</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:2.00744em;vertical-align:-.686em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.07153em">C</span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.686em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>我们通过统计 CPU 最本质的工作内容来获取 CPU 的工作情况。</p><p>通过使用性能监视计数器（PMCs）：可以使用<span class="exturl" data-url="aHR0cDovL3d3dy5icmVuZGFuZ3JlZ2cuY29tL3BlcmYuaHRtbA=="> Linux perf</span> 和其他工具读取的硬件计数器。</p><p>例如，测量整个系统 10 秒钟：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># perf stat -a -- sleep 10</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre> Performance counter stats <span class="token keyword">for</span> <span class="token string">'system wide'</span><span class="token builtin class-name">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>     <span class="token number">641398.723351</span>      task-clock <span class="token punctuation">(</span>msec<span class="token punctuation">)</span>         <span class="token comment">#   64.116 CPUs utilized            (100.00%)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>           <span class="token number">379,651</span>      context-switches          <span class="token comment">#    0.592 K/sec                    (100.00%)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>            <span class="token number">51,546</span>      cpu-migrations            <span class="token comment">#    0.080 K/sec                    (100.00%)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token number">13,423</span>,039      page-faults               <span class="token comment">#    0.021 M/sec                  </span></pre></td></tr><tr><td data-num="9"></td><td><pre> <span class="token number">1,433</span>,972,173,374      cycles                    <span class="token comment">#    2.236 GHz                      (75.02%)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>   <span class="token operator">&lt;</span>not supported<span class="token operator">></span>      stalled-cycles-frontend  </pre></td></tr><tr><td data-num="11"></td><td><pre>   <span class="token operator">&lt;</span>not supported<span class="token operator">></span>      stalled-cycles-backend   </pre></td></tr><tr><td data-num="12"></td><td><pre> <span class="token number">1,118</span>,336,816,068      instructions              <span class="token comment">#    0.78  insns per cycle          (75.01%)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>   <span class="token number">249,644</span>,142,804      branches                  <span class="token comment">#  389.218 M/sec                    (75.01%)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>     <span class="token number">7,791</span>,449,769      branch-misses             <span class="token comment">#    3.12% of all branches          (75.01%)</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>      <span class="token number">10.003794539</span> seconds <span class="token function">time</span> elapsed</pre></td></tr></table></figure><p>这里的关键指标是<strong>每个周期的指令数</strong>（IPC: insns per cycle），显示每个 CPU 时钟周期我们完成了多少条指令。</p><p>在例子中 IPC 的值是 0.78，也就是一个 CPU 时钟周期完了 0.78 条指令，而到该处理器的最高速度是 IPC：4.0。这也称为<em> 4-wide</em>，。这意味着，CPU 可以在每个时钟周期退出（完成）四条指令。这意味着 CPU 的真正利用率为:</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>C</mi><mi>P</mi><msub><mi>U</mi><mrow><mi>u</mi><mi>t</mi><mi>i</mi><mi>l</mi><mi>i</mi><mi>z</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow></msub><mo>=</mo><mfrac><mrow><mi>I</mi><mi>P</mi><msub><mi>C</mi><mrow><mi>m</mi><mi>e</mi><mi>a</mi><mi>s</mi><mi>u</mi><mi>r</mi><mi>e</mi></mrow></msub></mrow><mrow><mi>I</mi><mi>P</mi><msub><mi>C</mi><mrow><mi>C</mi><mi>P</mi><mi>U</mi><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub></mrow></mfrac><mo>=</mo><mfrac><mn>0.78</mn><mn>4</mn></mfrac><mo>=</mo><mn>19.5</mn></mrow><annotation encoding="application/x-tex">CPU_{utilization} = \frac{IPC_{measure}}{IPC_{CPUmax}} = \frac{0.78}{4} = 19.5%</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.83333em;vertical-align:-.15em"></span><span class="mord mathnormal" style="margin-right:.07153em">C</span><span class="mord mathnormal" style="margin-right:.13889em">P</span><span class="mord"><span class="mord mathnormal" style="margin-right:.10903em">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.33610799999999996em"><span style="top:-2.5500000000000003em;margin-left:-.10903em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:.01968em">l</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:.04398em">z</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:2.19633em;vertical-align:-.8360000000000001em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em"><span style="top:-2.3139999999999996em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.07847em">I</span><span class="mord mathnormal" style="margin-right:.13889em">P</span><span class="mord"><span class="mord mathnormal" style="margin-right:.07153em">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.32833099999999993em"><span style="top:-2.5500000000000003em;margin-left:-.07153em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.07153em">C</span><span class="mord mathnormal mtight" style="margin-right:.13889em">P</span><span class="mord mathnormal mtight" style="margin-right:.10903em">U</span><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">x</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.07847em">I</span><span class="mord mathnormal" style="margin-right:.13889em">P</span><span class="mord"><span class="mord mathnormal" style="margin-right:.07153em">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.151392em"><span style="top:-2.5500000000000003em;margin-left:-.07153em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight" style="margin-right:.02778em">r</span><span class="mord mathnormal mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.8360000000000001em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:2.00744em;vertical-align:-.686em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">4</span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span><span class="mord">.</span><span class="mord">7</span><span class="mord">8</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.686em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">1</span><span class="mord">9</span><span class="mord">.</span><span class="mord">5</span></span></span></span></span></p><p>在 Linux 上，我们可以通过 <code>Tiptop</code> 工具获取 IPC</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>tiptop -                  <span class="token punctuation">[</span>root<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="2"></td><td><pre>Tasks:  <span class="token number">96</span> total,   <span class="token number">3</span> displayed                               <span class="token function">screen</span>  <span class="token number">0</span>: default</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>  PID <span class="token punctuation">[</span> %CPU<span class="token punctuation">]</span> %SYS    P   Mcycle   Minstr   IPC  %MISS  %BMIS  %BUS COMMAND</pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token number">3897</span>   <span class="token number">35.3</span>  <span class="token number">28.5</span>    <span class="token number">4</span>   <span class="token number">274.06</span>   <span class="token number">178.23</span>  <span class="token number">0.65</span>   <span class="token number">0.06</span>   <span class="token number">0.00</span>   <span class="token number">0.0</span> java</pre></td></tr><tr><td data-num="6"></td><td><pre> <span class="token number">1319</span>+   <span class="token number">5.5</span>   <span class="token number">2.6</span>    <span class="token number">6</span>    <span class="token number">87.32</span>   <span class="token number">125.55</span>  <span class="token number">1.44</span>   <span class="token number">0.34</span>   <span class="token number">0.26</span>   <span class="token number">0.0</span> nm-applet</pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token number">900</span>    <span class="token number">0.9</span>   <span class="token number">0.0</span>    <span class="token number">6</span>    <span class="token number">25.91</span>    <span class="token number">55.55</span>  <span class="token number">2.14</span>   <span class="token number">0.12</span>   <span class="token number">0.21</span>   <span class="token number">0.0</span> dbus-daemo</pre></td></tr></table></figure><h2 id="use-and-understand-it"><a class="anchor" href="#use-and-understand-it">#</a> Use and Understand it !</h2><p>我们需要一个基础来告诉我们 IPC 的数据意味者什么？不然即使拿到 IPC 的数据，知道了利用率也无从下手。</p><p>那么首先我们需要编写两个虚拟的工作负载：</p><ul><li>一个只不断执行指令的任务（理想的工作 IPC）</li><li>一个只不断执行内存访问（无序的）的任务（最糟糕内容延迟）</li></ul><p>使用工具采集两个任务的 IPC，然后计算中点系数：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>系数</mtext><mo>=</mo><mfrac><mrow><mi>I</mi><mi>P</mi><msub><mi>C</mi><mrow><mi>i</mi><mi>n</mi><mi>s</mi></mrow></msub><mo>+</mo><mi>I</mi><mi>P</mi><msub><mi>C</mi><mrow><mi>m</mi><mi>e</mi><mi>m</mi></mrow></msub></mrow><mn>2</mn></mfrac></mrow><annotation encoding="application/x-tex">系数= \frac{IPC_{ins} + IPC_{mem}}{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.68333em;vertical-align:0"></span><span class="mord cjk_fallback">系</span><span class="mord cjk_fallback">数</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:2.04633em;vertical-align:-.686em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.07847em">I</span><span class="mord mathnormal" style="margin-right:.13889em">P</span><span class="mord"><span class="mord mathnormal" style="margin-right:.07153em">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.31166399999999994em"><span style="top:-2.5500000000000003em;margin-left:-.07153em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord mathnormal" style="margin-right:.07847em">I</span><span class="mord mathnormal" style="margin-right:.13889em">P</span><span class="mord"><span class="mord mathnormal" style="margin-right:.07153em">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.151392em"><span style="top:-2.5500000000000003em;margin-left:-.07153em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">m</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.686em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>这样是让我们获取计算机的平均基准 IPC，然后我们将这个基准定位 1。</p><p>然后对于特定程序进行测量获取 IPC，然后计算:</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>I</mi><mi>P</mi><msub><mi>C</mi><mi>t</mi></msub><mo>=</mo><mfrac><mrow><mi>I</mi><mi>P</mi><msub><mi>C</mi><mrow><mi>g</mi><mi>e</mi><mi>t</mi></mrow></msub></mrow><mtext>系数</mtext></mfrac></mrow><annotation encoding="application/x-tex">IPC_{t} = \frac{IPC_{get}}{系数}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.83333em;vertical-align:-.15em"></span><span class="mord mathnormal" style="margin-right:.07847em">I</span><span class="mord mathnormal" style="margin-right:.13889em">P</span><span class="mord"><span class="mord mathnormal" style="margin-right:.07153em">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.2805559999999999em"><span style="top:-2.5500000000000003em;margin-left:-.07153em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:2.04633em;vertical-align:-.686em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord cjk_fallback">系</span><span class="mord cjk_fallback">数</span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.07847em">I</span><span class="mord mathnormal" style="margin-right:.13889em">P</span><span class="mord"><span class="mord mathnormal" style="margin-right:.07153em">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.28055599999999997em"><span style="top:-2.5500000000000003em;margin-left:-.07153em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.03588em">g</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.286108em"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.686em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><ul><li><strong><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mi>P</mi><msub><mi>C</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">IPC_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.83333em;vertical-align:-.15em"></span><span class="mord mathnormal" style="margin-right:.07847em">I</span><span class="mord mathnormal" style="margin-right:.13889em">P</span><span class="mord"><span class="mord mathnormal" style="margin-right:.07153em">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.2805559999999999em"><span style="top:-2.5500000000000003em;margin-left:-.07153em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span> &lt;1.0</strong>：则可能是内存停滞了<ul><li>软件调整：包括减少内存 I / O 并改善 CPU 缓存和内存局部性，尤其是在 NUMA 系统上。</li><li>硬件调整：使用具有更大 CPU 缓存，更快的内存，总线和互连的处理器。</li></ul></li><li><strong><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mi>P</mi><msub><mi>C</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">IPC_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.83333em;vertical-align:-.15em"></span><span class="mord mathnormal" style="margin-right:.07847em">I</span><span class="mord mathnormal" style="margin-right:.13889em">P</span><span class="mord"><span class="mord mathnormal" style="margin-right:.07153em">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.2805559999999999em"><span style="top:-2.5500000000000003em;margin-left:-.07153em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span> &gt; 1.0</strong>：则很可能受指令约束。<ul><li>软件调整：寻找减少代码执行的方法：消除不必要的工作，缓存操作等。<span class="exturl" data-url="aHR0cDovL3d3dy5icmVuZGFuZ3JlZ2cuY29tL0ZsYW1lR3JhcGhzL2NwdWZsYW1lZ3JhcGhzLmh0bWw=">CPU 火焰图</span>是进行此研究的好工具。</li><li>硬件调整，使用更快的时钟速率和更多的内核 / 超线程。</li></ul></li></ul><blockquote><p>对于 $IPC_t $&gt; 1 的例子:</p><p>一个程序使用了自旋锁，此时有较高的 IPC，但该应用程序未在逻辑上前进。</p></blockquote><h2 id="references"><a class="anchor" href="#references">#</a> References</h2><p>[1]Brendan Gregg.CPU Utilization is Wrong[EB/OL].<span class="exturl" data-url="aHR0cDovL3d3dy5icmVuZGFuZ3JlZ2cuY29tL2Jsb2cvMjAxNy0wNS0wOS9jcHUtdXRpbGl6YXRpb24taXMtd3JvbmcuaHRtbCwyMDE3LTUtOQ==">http://www.brendangregg.com/blog/2017-05-09/cpu-utilization-is-wrong.html,2017-5-9</span>.<br>[2]Brendan Gregg.The USE Method[EB/OL].<span class="exturl" data-url="aHR0cDovL3d3dy5icmVuZGFuZ3JlZ2cuY29tL3VzZW1ldGhvZC5odG1sI0Fwb2xsbywyMDE3LTgtMQ==">http://www.brendangregg.com/usemethod.html#Apollo,2017-8-1</span>.<br>[3]Brendan Gregg.Linux Load Averages: Solving the Mystery[EB/OL].<span class="exturl" data-url="aHR0cDovL3d3dy5icmVuZGFuZ3JlZ2cuY29tL2Jsb2cvMjAxNy0wOC0wOC9saW51eC1sb2FkLWF2ZXJhZ2VzLmh0bWwsMjAxNy04LTg=">http://www.brendangregg.com/blog/2017-08-08/linux-load-averages.html,2017-8-8</span>.<br>[4]Wikipedia.CPU_time[EB/OL].<span class="exturl" data-url="aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQ1BVX3RpbWUsMjAyMC01LTEx">https://en.wikipedia.org/wiki/CPU_time,2020-5-11</span>.</p><div class="tags"><a href="/tags/Linux/" rel="tag"><i class="ic i-tag"></i> Linux</a> <a href="/tags/%E4%BC%98%E5%8C%96/" rel="tag"><i class="ic i-tag"></i> 优化</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2021-04-18 19:34:18" itemprop="dateModified" datetime="2021-04-18T19:34:18+08:00">2021-04-18</time></span></div><div id="lv-container" data-id="city" data-uid="MTAyMC80MzY4Ni8yMDIyNg=="><script type="text/javascript">!function(e,t){var n,c=e.getElementsByTagName(t)[0];"function"!=typeof LivereTower&&(n=e.createElement(t),n.src="https://cdn-city.livere.com/js/embed.dist.js",n.async=!0,c.parentNode.insertBefore(n,c))}(document,"script")</script><noscript>为正常使用来必力评论功能请激活JavaScript</noscript></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="Junwide Xiao 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="Junwide Xiao 支付宝"><p>支付宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>Junwide Xiao <i class="ic i-at"><em>@</em></i>精神小伙</li><li class="link"><strong>本文链接：</strong> <a href="https://junwide.github.io/Linux-Basic/Linux%20%E8%A7%A3%E5%AF%86%E2%80%94CPU%E5%88%A9%E7%94%A8%E7%8E%87/" title="Linux 解密—CPU利用率">https://junwide.github.io/Linux-Basic/Linux 解密—CPU利用率/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/Linux-Basic/Linux%20Kernel%20Build/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;gitee.com&#x2F;junwide&#x2F;blog&#x2F;raw&#x2F;master&#x2F;20210418104136.jpg" title="Linux Kernel Build"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> Linux基础</span><h3>Linux Kernel Build</h3></a></div><div class="item right"><a href="/Linux-Basic/Kernel%20Module%20%E2%80%94%20Simple%20Example/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;gitee.com&#x2F;junwide&#x2F;blog&#x2F;raw&#x2F;master&#x2F;20210418104513.jpg" title="Kernel Module — Simple Example"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> Linux基础</span><h3>Kernel Module — Simple Example</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#linux-%E8%A7%A3%E5%AF%86cpu%E5%88%A9%E7%94%A8%E7%8E%87"><span class="toc-number">1.</span> <span class="toc-text">Linux 解密 —CPU 利用率</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#what-s-the-cpu-utilization"><span class="toc-number">1.1.</span> <span class="toc-text">What ‘s the CPU Utilization</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#how-to-measure"><span class="toc-number">1.2.</span> <span class="toc-text">How to measure</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#it-is-true"><span class="toc-number">1.3.</span> <span class="toc-text">It is True？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#back-to-definition"><span class="toc-number">1.4.</span> <span class="toc-text">Back to Definition</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#use-and-understand-it"><span class="toc-number">1.5.</span> <span class="toc-text">Use and Understand it !</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#references"><span class="toc-number">1.6.</span> <span class="toc-text">References</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/Linux-Basic/UPBoard%20%E4%BC%98%E5%8C%96%E4%BF%AE%E5%A4%8D%E6%8C%87%E5%8D%97/" rel="bookmark" title="UPBoard 优化修复指南">UPBoard 优化修复指南</a></li><li><a href="/Linux-Basic/Linux%20Kernel%20Build/" rel="bookmark" title="Linux Kernel Build">Linux Kernel Build</a></li><li class="active"><a href="/Linux-Basic/Linux%20%E8%A7%A3%E5%AF%86%E2%80%94CPU%E5%88%A9%E7%94%A8%E7%8E%87/" rel="bookmark" title="Linux 解密—CPU利用率">Linux 解密—CPU利用率</a></li><li><a href="/Linux-Basic/Kernel%20Module%20%E2%80%94%20Simple%20Example/" rel="bookmark" title="Kernel Module — Simple Example">Kernel Module — Simple Example</a></li><li><a href="/Linux-Basic/devnull%20%E2%80%94%E2%80%94The%20Bit%20Bucket/" rel="bookmark" title="/dev/null ——The Bit Bucket 的故事">/dev/null ——The Bit Bucket 的故事</a></li><li><a href="/Linux-Basic/Kernel%20Module%20%E2%80%94%20Char%20Device%20Basic/" rel="bookmark" title="Kernel Module — Char Device  Driver">Kernel Module — Char Device Driver</a></li><li><a href="/Linux-Basic/Kernel%20Module%20%E2%80%94%20Char%20Device%20Basic%20II/" rel="bookmark" title="Kernel Module — Char Device Basic II">Kernel Module — Char Device Basic II</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Junwide Xiao" data-src="/images/avatar.jpg"><p class="name" itemprop="name">Junwide Xiao</p><div class="description" itemprop="description">生活与技术</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">25</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">6</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">24</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL2p1bndpZGU=" title="https:&#x2F;&#x2F;github.com&#x2F;junwide"><i class="ic i-github"></i></span> <span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29t" title="https:&#x2F;&#x2F;www.zhihu.com"><i class="ic i-zhihu"></i></span> <span class="exturl item weibo" data-url="aHR0cHM6Ly93ZWliby5jb20=" title="https:&#x2F;&#x2F;weibo.com"><i class="ic i-weibo"></i></span> <a href="https://junwide.github.io/about" title="https:&#x2F;&#x2F;junwide.github.io&#x2F;about" class="item about"><i class="ic i-address-card"></i></a> <span class="exturl item email" data-url="bWFpbHRvOmp1bndpZGVAb3V0bG9vay5jb20=" title="mailto:junwide@outlook.com"><i class="ic i-envelope"></i></span> <span class="exturl item youtube" data-url="aHR0cHM6Ly95b3V0dWJlLmNvbQ==" title="https:&#x2F;&#x2F;youtube.com"><i class="ic i-youtube"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/Linux-Basic/Linux%20Kernel%20Build/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/Linux-Basic/Kernel%20Module%20%E2%80%94%20Simple%20Example/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/embed-system/" title="分类于 嵌入式系统">嵌入式系统</a></div><span><a href="/embed-system/%E7%AE%80%E5%8D%95MCU%E8%AF%BE%E8%AE%BE%E5%BC%80%E6%BA%90--%E7%94%B5%E5%AD%90%E9%92%9F/" title="简单MCU课设开源--电子钟">简单MCU课设开源--电子钟</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/linux-basic/" title="分类于 Linux基础">Linux基础</a></div><span><a href="/Linux-Basic/Linux%20Kernel%20Build/" title="Linux Kernel Build">Linux Kernel Build</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/theme-shoka-doc/" title="分类于 博客">博客</a></div><span><a href="/theme-shoka-doc/special/" title="Step.4 主题特殊功能">Step.4 主题特殊功能</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/theme-shoka-doc/" title="分类于 博客">博客</a></div><span><a href="/theme-shoka-doc/theme-shoka-doc/" title="Hexo主题Shoka &amp; multi-markdown-it渲染器使用说明">Hexo主题Shoka & multi-markdown-it渲染器使用说明</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/linux-basic/" title="分类于 Linux基础">Linux基础</a></div><span><a href="/Linux-Basic/Linux%20%E8%A7%A3%E5%AF%86%E2%80%94CPU%E5%88%A9%E7%94%A8%E7%8E%87/" title="Linux 解密—CPU利用率">Linux 解密—CPU利用率</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/normal-Skill/" title="分类于 其他技巧">其他技巧</a></div><span><a href="/normal-Skill/Google_%E6%90%9C%E7%B4%A2%E6%8C%87%E5%8D%97/" title="谷歌搜索技巧">谷歌搜索技巧</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/linux-basic/" title="分类于 Linux基础">Linux基础</a></div><span><a href="/Linux-Basic/Kernel%20Module%20%E2%80%94%20Char%20Device%20Basic/" title="Kernel Module — Char Device  Driver">Kernel Module — Char Device Driver</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/theme-shoka-doc/" title="分类于 博客">博客</a></div><span><a href="/theme-shoka-doc/dependents/" title="Step.1 依赖插件">Step.1 依赖插件</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/other/" title="分类于 杂项">杂项</a></div><span><a href="/Other/Tech%20New%20Innovation/" title="Tech New Innovation">Tech New Innovation</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Program/" title="分类于 编程技术">编程技术</a></div><span><a href="/Program/SWDevelopmentSkill/" title="SW Development Skill">SW Development Skill</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2021</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Junwide Xiao @ Brain Home</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">140k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">4:14</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"Linux-Basic/Linux 解密—CPU利用率/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,copy_tex:!0,katex:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html>