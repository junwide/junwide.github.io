<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="精神小伙" href="https://junwide.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" title="精神小伙" href="https://junwide.github.io/atom.xml"><link rel="alternate" type="application/json" title="精神小伙" href="https://junwide.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="嵌入式,ARM,STM32"><link rel="canonical" href="https://junwide.github.io/embed-system/MCU%E4%B8%8E%E5%B5%8C%E5%85%A5%E5%BC%8F-%E5%9F%BA%E7%A1%80%E6%A6%82%E7%8E%871/"><title>01| MCU与嵌入式:基础概率 - 嵌入式系统 | Brain Home = 精神小伙 = Tech.&Mem.</title><meta name="generator" content="Hexo 5.4.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">01| MCU与嵌入式:基础概率</h1><div class="meta"><span class="item" title="创建时间：2020-05-27 23:00:00"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2020-05-27T23:00:00+08:00">2020-05-27</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>11k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>21 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Brain Home</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://gitee.com/junwide/blog/raw/master/20210418104136.jpg"></li><li class="item" data-background-image="https://gitee.com/junwide/blog/raw/master/20210418104528.jpg"></li><li class="item" data-background-image="https://gitee.com/junwide/blog/raw/master/20210418104627.jpg"></li><li class="item" data-background-image="https://gitee.com/junwide/blog/raw/master/20210418104434.jpg"></li><li class="item" data-background-image="https://gitee.com/junwide/blog/raw/master/20210418104415.jpg"></li><li class="item" data-background-image="https://gitee.com/junwide/blog/raw/master/20210418104554.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/embed-system/" itemprop="item" rel="index" title="分类于 嵌入式系统"><span itemprop="name">嵌入式系统</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://junwide.github.io/embed-system/MCU%E4%B8%8E%E5%B5%8C%E5%85%A5%E5%BC%8F-%E5%9F%BA%E7%A1%80%E6%A6%82%E7%8E%871/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Junwide Xiao"><meta itemprop="description" content="Tech.&Mem., 生活与技术"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="精神小伙"></span><div class="body md" itemprop="articleBody"><h1 id="01-mcu与嵌入式基础概率"><a class="anchor" href="#01-mcu与嵌入式基础概率">#</a> 01| MCU 与嵌入式：基础概率</h1><hr><h2 id="11-选型和比较"><a class="anchor" href="#11-选型和比较">#</a> 1.1| 选型和比较</h2><h3 id="11-特性比较"><a class="anchor" href="#11-特性比较">#</a> 1.1| 特性比较</h3><h4 id="温度特性"><a class="anchor" href="#温度特性">#</a> 温度特性：</h4><p>设计产品的工作温度区间，是民用级，还是军工级，单片机芯片在一些高 / 低温的环境下，会出现代码起飞，内部 FLASH 莫名丢失等问题。</p><h4 id="低功耗特性"><a class="anchor" href="#低功耗特性">#</a> 低功耗特性</h4><p>芯片是否有较好的休眠模式，大多芯片厂家都非常注重硬件低功耗模式，提出了各种各样的睡眠方式，TI 就是把低功耗做的很好的厂家。如果是设计电池供电的产品，一定要考虑低功耗。低功耗更多需要代码去优化，具体可以学习专门的低功耗优化方式</p><blockquote><p>一个纽扣电池，产品用一年</p></blockquote><h4 id="芯片热度"><a class="anchor" href="#芯片热度">#</a> 芯片热度</h4><p>比如 STM32 的技术支持非常丰富，由 Datasheet 直接开发吃力的话，一定要选选用社区维护和热度高这样的芯片。</p><p>而冷门芯片则是一个挑战，搜索引擎的资料较少，通常得写 e-mail 给原厂工程师，开发效率有所低下。</p><h4 id="开发环境"><a class="anchor" href="#开发环境">#</a> 开发环境</h4><p>IAR 或者 MDK（Keli）CORTEX-Mx 系列的单片机多半都是用 MDK 开发的。TI 的产品大多是用 IAR。一个熟悉的开发环境能够更快的上手。</p><h4 id="抗干扰性"><a class="anchor" href="#抗干扰性">#</a> 抗干扰性</h4><p>选用单片机要选择抗干扰性能好的，特别是用在干扰比较大的工业环境中，单片机加密后的保密性能也要好，这样可保证知识产权不容易被侵犯</p><h4 id="操作系统"><a class="anchor" href="#操作系统">#</a> 操作系统</h4><h5 id="no-os"><a class="anchor" href="#no-os">#</a> No-OS</h5><p>No-OS 单片机，可以从启动时的汇编代码开始，到配置好时钟，配置好各样的寄存器，所有的代码都是你自己写的，出了问题自己找，这样能最大程度的提高 debug 效率。No-OS 的单片机代码，虽然简单，但是所能做的功能也会有局限。</p><h5 id="实时操作系统"><a class="anchor" href="#实时操作系统">#</a> 实时操作系统</h5><ol><li><strong>当需要用复杂协议栈的时候，操作系统变得非常有用</strong></li><li><strong>当需要运行多个复杂任务的时候，操作系统很有用</strong></li><li><strong>可移植性高</strong></li></ol><h4 id="封装"><a class="anchor" href="#封装">#</a> 封装</h4><p>单片机常见的封装形式有：</p><ul><li>DIP（双列直插式封装）</li><li>PLCC（PLCC 要对应插座）</li><li>QFP（四侧引脚扁平封装，一般采用 SMD）</li><li>QFN（无引线四方形扁平无引脚封装）</li><li>SOP（双列小外形贴片封装）</li><li>BGA 技术（球栅阵列封装，底部植球）</li><li>PQFP（塑封四角扁平封装）</li><li>Flip Chip（倒装片）</li></ul><blockquote><p>做实验时一般选用 DIP 封装的，如果选用其它封装，用编程器编程时还配专用的适配器。如果对系统的体积有要求，如遥控器中用的单片机，往往选用 QFP 和 SOP 封装的。</p></blockquote><p><img data-src="https://gitee.com/junwide/blog/raw/master/20200628002258.png" alt="封装.png"></p><h3 id="12-架构分布arm为例"><a class="anchor" href="#12-架构分布arm为例">#</a> 1.2| 架构分布（ARM 为例）</h3><ul><li><strong>款式 A：设计用于高性能的 “开放应用平台”</strong>——PC</li><li><strong>款式 R：用于高端的嵌入式系统，尤其是那些带有实时要求的</strong> —— 车载</li><li><strong>款式 M：用于深度嵌入的，单片机风格 的系统中</strong> ——stm32</li></ul><p><img data-src="https://gitee.com/junwide/blog/raw/master/20200628003044.png" alt="">&quot;</p><h4 id="cortex-m3"><a class="anchor" href="#cortex-m3">#</a> Cortex-M3</h4><p>CM3 采用了哈佛结构，拥有独立的指令总线和数据总线，可以让取指与数据访问并行不悖。</p><p><img data-src="https://gitee.com/junwide/blog/raw/master/20200628002911.png" alt=""></p><p><img data-src="https://gitee.com/junwide/blog/raw/master/20200628003003.png" alt=""></p><blockquote><p>流水线的 3 级分别是：取指，解码和执行</p></blockquote><h4 id="mpumemory-protect-unit"><a class="anchor" href="#mpumemory-protect-unit">#</a> MPU（Memory Protect Unit）</h4><p>Cortex‐M3 有一个可选的存储器保护单元。配上它之后，就可以对特权级访问和用户级访问分别施加不同的访问限制。当检测到（violated）时，MPU 就会产生一个 fault 异常，可以由 fault 异常的服务例程来分析该错误，并且在可能时改正它。</p><h4 id="fpufoating-point-unit"><a class="anchor" href="#fpufoating-point-unit">#</a> FPU(Foating point unit)</h4><p>专门作为浮点运算的处理单元，能够大幅度提供浮点运算的速度和减小误差，提高准确度的问题。</p><h2 id="12-存储器和总线架构"><a class="anchor" href="#12-存储器和总线架构">#</a> 1.2| 存储器和总线架构</h2><h3 id="121-存储器整体架构"><a class="anchor" href="#121-存储器整体架构">#</a> 1.2.1| 存储器整体架构</h3><p><img data-src="https://gitee.com/junwide/blog/raw/master/20200628004028.png" alt=""></p><p><img data-src="https://gitee.com/junwide/blog/raw/master/20200628004054.png" alt=""></p><h4 id="i-code-总线"><a class="anchor" href="#i-code-总线">#</a> I-Code 总线</h4><p>该总线将 Cortex™-M3 内核的指令总线与闪存指令接口相连接。指令预取在此总线上完成。</p><h4 id="d-code-总线"><a class="anchor" href="#d-code-总线">#</a> D-Code 总线</h4><p>该总线将 Cortex™-M3 内核的 D-Code 总线与闪存存储器的数据接口相连接 (常量加载和调试访问)。</p><h4 id="系统总线"><a class="anchor" href="#系统总线">#</a> 系统总线</h4><p>此总线连接 Cortex™-M3 内核的系统总线 (外设总线) 到总线矩阵，总线矩阵协调着内核和 DMA 间的访问。</p><h4 id="dma-总线"><a class="anchor" href="#dma-总线">#</a> DMA 总线</h4><p>此总线将 DMA 的 AHB 主控接口与总线矩阵相联，总线矩阵协调着 CPU 的 D-Code 和 DMA 到 SRAM、闪存和外设的访问。</p><h4 id="总线矩阵"><a class="anchor" href="#总线矩阵">#</a> 总线矩阵</h4><p>总线矩阵协调内核系统总线和 DMA 主控总线之间的访问仲裁，仲裁利用轮换算法。</p><p>AHB 外设通过总线矩阵与系统总线相连，允许 DMA 访问。</p><h4 id="ahbapb-桥apb"><a class="anchor" href="#ahbapb-桥apb">#</a> AHB/APB 桥 (APB)</h4><p>两个 AHB/APB 桥在 AHB 和 2 个 APB 总线间提供同步连接。APB1 操作速度限于<strong> 36MHz</strong>，APB2 操作于全速 (最高<strong> 72MHz)</strong>。</p><p>闪存的指令和数据访问是通过 AHB 总线完成的。预取模块是用于通过 I-Code 总线读取指令的。仲裁是作用在闪存接口，并且 D-Code 总线上的数据访问优先。</p><blockquote><p>注意： 当对 APB 寄存器进行 8 位或者 16 位访问时，该访问会被自动转换成 32 位的访问：桥会自动将 8 位或者 32 位的数据扩展以配合 32 位的向量</p></blockquote><h3 id="122-存储器的映像"><a class="anchor" href="#122-存储器的映像">#</a> 1.2.2| 存储器的映像</h3><h4 id="映射表见手册"><a class="anchor" href="#映射表见手册">#</a> 映射表 (见手册)</h4><h4 id="位带操作"><a class="anchor" href="#位带操作">#</a> 位带操作</h4><p>位带操作就是把位带区中一个地址的 8 个位分别映射到位带别名区的 8 个地址（LSB 有效，即最低位有效），通过操作相应地址的方式实现操作某个位，如图。其支持位带操作的两个内存区域为：</p><p><img data-src="https://gitee.com/junwide/blog/raw/master/20200628004153.png" alt=""></p><blockquote><p>0x20000000 的第 0 位对应 0x22000000，第 1 位对应 0x22000004 等。前文提到，别名区地址的 LSB 有效，可理解为位带区里每个位的状态只与别名区里地址存储的字的奇偶性有关，通过换算可知，奇数的 LSB 为 1，偶数的 LSB 为 0。</p></blockquote><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>别名区地址</mtext><mo>=</mo><mtext>别名区起始地址</mtext><mo>+</mo><mtext>（位字节地址偏移量</mtext><mo>∗</mo><mn>8</mn><mo>+</mo><mi>n</mi><mtext>）</mtext><mo>∗</mo><mn>4</mn></mrow><annotation encoding="application/x-tex">别名区地址 = 别名区起始地址 + （位字节地址偏移量 * 8 + n） * 4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.68333em;vertical-align:0"></span><span class="mord cjk_fallback">别</span><span class="mord cjk_fallback">名</span><span class="mord cjk_fallback">区</span><span class="mord cjk_fallback">地</span><span class="mord cjk_fallback">址</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.76666em;vertical-align:-.08333em"></span><span class="mord cjk_fallback">别</span><span class="mord cjk_fallback">名</span><span class="mord cjk_fallback">区</span><span class="mord cjk_fallback">起</span><span class="mord cjk_fallback">始</span><span class="mord cjk_fallback">地</span><span class="mord cjk_fallback">址</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.68333em;vertical-align:0"></span><span class="mord cjk_fallback">（</span><span class="mord cjk_fallback">位</span><span class="mord cjk_fallback">字</span><span class="mord cjk_fallback">节</span><span class="mord cjk_fallback">地</span><span class="mord cjk_fallback">址</span><span class="mord cjk_fallback">偏</span><span class="mord cjk_fallback">移</span><span class="mord cjk_fallback">量</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.72777em;vertical-align:-.08333em"></span><span class="mord">8</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.68333em;vertical-align:0"></span><span class="mord mathnormal">n</span><span class="mord cjk_fallback">）</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">4</span></span></span></span></span></p><pre><code>                             (以字节为单位时，n∈[0,7]；以字为单位时，n∈[0,31]）)
</code></pre><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>S</mi><mi>R</mi><mi>A</mi><mi>M</mi><mtext>区：别名区地址</mtext><mo>=</mo><mn>0</mn><mi>x</mi><mn>22000000</mn><mo>+</mo><mtext>（</mtext><mi>A</mi><mo>−</mo><mn>0</mn><mi>x</mi><mn>20000000</mn><mtext>）</mtext><mo>∗</mo><mn>32</mn><mo>+</mo><mi>n</mi><mo>∗</mo><mn>4</mn></mrow><annotation encoding="application/x-tex">SRAM区：别名区地址 = 0x22000000 + （A - 0x20000000）* 32 + n * 4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.68333em;vertical-align:0"></span><span class="mord mathnormal" style="margin-right:.05764em">S</span><span class="mord mathnormal" style="margin-right:.00773em">R</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:.10903em">M</span><span class="mord cjk_fallback">区</span><span class="mord cjk_fallback">：</span><span class="mord cjk_fallback">别</span><span class="mord cjk_fallback">名</span><span class="mord cjk_fallback">区</span><span class="mord cjk_fallback">地</span><span class="mord cjk_fallback">址</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.72777em;vertical-align:-.08333em"></span><span class="mord">0</span><span class="mord mathnormal">x</span><span class="mord">2</span><span class="mord">2</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.76666em;vertical-align:-.08333em"></span><span class="mord cjk_fallback">（</span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.68333em;vertical-align:0"></span><span class="mord">0</span><span class="mord mathnormal">x</span><span class="mord">2</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord cjk_fallback">）</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.72777em;vertical-align:-.08333em"></span><span class="mord">3</span><span class="mord">2</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.46528em;vertical-align:0"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">4</span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>片上外设区：别名区地址</mtext><mo>=</mo><mn>0</mn><mi>x</mi><mn>42000000</mn><mo>+</mo><mtext>（</mtext><mi>A</mi><mo>−</mo><mn>0</mn><mi>x</mi><mn>40000000</mn><mtext>）</mtext><mo>∗</mo><mn>32</mn><mo>+</mo><mi>n</mi><mo>∗</mo><mn>4</mn></mrow><annotation encoding="application/x-tex">片上外设区：别名区地址 = 0x42000000 + （A - 0x40000000）* 32 + n * 4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.68333em;vertical-align:0"></span><span class="mord cjk_fallback">片</span><span class="mord cjk_fallback">上</span><span class="mord cjk_fallback">外</span><span class="mord cjk_fallback">设</span><span class="mord cjk_fallback">区</span><span class="mord cjk_fallback">：</span><span class="mord cjk_fallback">别</span><span class="mord cjk_fallback">名</span><span class="mord cjk_fallback">区</span><span class="mord cjk_fallback">地</span><span class="mord cjk_fallback">址</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.72777em;vertical-align:-.08333em"></span><span class="mord">0</span><span class="mord mathnormal">x</span><span class="mord">4</span><span class="mord">2</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.76666em;vertical-align:-.08333em"></span><span class="mord cjk_fallback">（</span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.68333em;vertical-align:0"></span><span class="mord">0</span><span class="mord mathnormal">x</span><span class="mord">4</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord cjk_fallback">）</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.72777em;vertical-align:-.08333em"></span><span class="mord">3</span><span class="mord">2</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.46528em;vertical-align:0"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">4</span></span></span></span></span></p><blockquote><p>A：位带区字节地址（GPIOX_BASE + 偏移地址）；<br>n：操作位号；<br>“*32”：前文提到，位带区每 1 位膨胀为别名区里一个 32 位的字，1 字 = 4 字节 = 32bit；<br>“*4”：1 字 = 4 字节</p></blockquote><figure class="highlight c"><figcaption data-lang="c"><span>位带计算</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIOA_ODR</span>  <span class="token expression"><span class="token punctuation">(</span>GPIOA_BASE <span class="token operator">+</span> <span class="token number">0x0C</span><span class="token punctuation">)</span> </span><span class="token comment">// 位带区字节地址，即为公式中的 “A”</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIOA_IDR</span>  <span class="token expression"><span class="token punctuation">(</span>GPIOA_BASE <span class="token operator">+</span> <span class="token number">0x08</span><span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIOE_ODR</span>  <span class="token expression"><span class="token punctuation">(</span>GPIOE_BASE <span class="token operator">+</span> <span class="token number">0x0C</span><span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIOE_IDR</span>  <span class="token expression"><span class="token punctuation">(</span>GPIOE_BASE <span class="token operator">+</span> <span class="token number">0x08</span><span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">BitBand</span><span class="token expression"><span class="token punctuation">(</span>Addr<span class="token punctuation">,</span> BitNum<span class="token punctuation">)</span>  <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">volatile</span> <span class="token keyword">unsigned</span> <span class="token keyword">long</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Addr <span class="token operator">&amp;</span> <span class="token number">0xF0000000</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">0x2000000</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>Addr <span class="token operator">&amp;</span> <span class="token number">0xFFFFF</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>BitNum <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> </span><span class="token comment">// 表达式</span></span></pre></td></tr><tr><td data-num="8"></td><td><pre> </pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">PAout</span><span class="token expression"><span class="token punctuation">(</span>n<span class="token punctuation">)</span>  <span class="token function">BitBand</span><span class="token punctuation">(</span>GPIOA_ODR<span class="token punctuation">,</span> n<span class="token punctuation">)</span> </span><span class="token comment">// 输出</span></span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">PAin</span><span class="token expression"><span class="token punctuation">(</span>n<span class="token punctuation">)</span>  <span class="token function">BitBand</span><span class="token punctuation">(</span>GPIOA_IDR<span class="token punctuation">,</span> n<span class="token punctuation">)</span> </span><span class="token comment">// 输入</span></span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">PAin</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token function">PAout</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token function">PAout</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h4 id="fsmc"><a class="anchor" href="#fsmc">#</a> FSMC</h4><p>待补充</p><h3 id="123-crc计算单元"><a class="anchor" href="#123-crc计算单元">#</a> 1.2.3| CRC 计算单元</h3><hr><p>循环冗余校验 (CRC) 计算单元是根据固定的生成多项式得到任一 32 位全字的 CRC 计算结果。在其他的应用中， CRC 技术主要应用于核实数据传输或者数据存储的正确性和完整性。标准 EN/IEC 60335-1 即提供了一种核实闪存存储器完整性的方法。CRC 计算单元可以在程序运行时计算出软件的标识，之后与在连接时生成的参考标识比较，然后存放在指定的存储器空间。</p><p>使用 CRC-32 (以太网) 多项式：0x4C11DB7</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>X</mi><mn>32</mn></msup><mo>+</mo><msup><mi>X</mi><mn>26</mn></msup><mo>+</mo><msup><mi>X</mi><mn>23</mn></msup><mo>+</mo><mi>X</mi><msup><mn>2</mn><mn>22</mn></msup><mo>+</mo><msup><mi>X</mi><mn>16</mn></msup><mo>+</mo><msup><mi>X</mi><mn>12</mn></msup><mo>+</mo><msup><mi>X</mi><mn>11</mn></msup><mo>+</mo><msup><mi>X</mi><mn>10</mn></msup><mo>+</mo><msup><mi>X</mi><mn>8</mn></msup><mo>+</mo><msup><mi>X</mi><mn>7</mn></msup><mo>+</mo><msup><mi>X</mi><mn>4</mn></msup><mo>+</mo><msup><mi>X</mi><mn>2</mn></msup><mo>+</mo><mi>X</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">X^{32} + X^{26} + X^{23} + X 2^{22} + X^{16}+ X^{12} + X^{11} + X^{10} + X^8 + X^7 + X^4 + X^2 + X +1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.9474379999999999em;vertical-align:-.08333em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.07847em">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8641079999999999em"><span style="top:-3.113em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.9474379999999999em;vertical-align:-.08333em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.07847em">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8641079999999999em"><span style="top:-3.113em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">6</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.9474379999999999em;vertical-align:-.08333em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.07847em">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8641079999999999em"><span style="top:-3.113em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">3</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.9474379999999999em;vertical-align:-.08333em"></span><span class="mord mathnormal" style="margin-right:.07847em">X</span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8641079999999999em"><span style="top:-3.113em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.9474379999999999em;vertical-align:-.08333em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.07847em">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8641079999999999em"><span style="top:-3.113em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">6</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.9474379999999999em;vertical-align:-.08333em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.07847em">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8641079999999999em"><span style="top:-3.113em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.9474379999999999em;vertical-align:-.08333em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.07847em">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8641079999999999em"><span style="top:-3.113em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.9474379999999999em;vertical-align:-.08333em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.07847em">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8641079999999999em"><span style="top:-3.113em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">0</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.9474379999999999em;vertical-align:-.08333em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.07847em">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8641079999999999em"><span style="top:-3.113em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">8</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.9474379999999999em;vertical-align:-.08333em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.07847em">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8641079999999999em"><span style="top:-3.113em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">7</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.9474379999999999em;vertical-align:-.08333em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.07847em">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8641079999999999em"><span style="top:-3.113em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.9474379999999999em;vertical-align:-.08333em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.07847em">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8641079999999999em"><span style="top:-3.113em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.76666em;vertical-align:-.08333em"></span><span class="mord mathnormal" style="margin-right:.07847em">X</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">1</span></span></span></span></span></p><p><img data-src="https://gitee.com/junwide/blog/raw/master/20200628004225.png" alt=""></p><h2 id="13-电源控制"><a class="anchor" href="#13-电源控制">#</a> 1.3| 电源控制</h2><h3 id="131-电源系统"><a class="anchor" href="#131-电源系统">#</a> 1.3.1| 电源系统</h3><ul><li>STM32 的工作电压 (V <sub>DD</sub> ) 为 2.0～3.6V。</li><li>内置的电压调节器提供所需的 1.8V 电源</li><li>当主电源 V <sub>DD</sub> 掉电后，通过 V <sub>BAT</sub> 脚为实时时钟 (RTC) 和备份寄存器提供电源</li><li>为了提高转换的精确度，ADC 使用一个独立的电源供电，过滤和屏蔽来自印刷电路板上的毛刺<br>干扰。</li><li>ADC 的电源引脚为 V<sub>DDA</sub></li><li>独立的电源地 V<sub>SSA</sub><br>如果有 V<sub>REF-</sub> 引脚 (根据封装而定)，它必须连接到 V<sub>SSA</sub></li></ul><p><img data-src="https://gitee.com/junwide/blog/raw/master/20200628004249.png" alt=""></p><p><img data-src="https://gitee.com/junwide/blog/raw/master/20200628004307.png" alt=""></p><h4 id="电压调节器"><a class="anchor" href="#电压调节器">#</a> 电压调节器</h4><p>复位后调节器总是使能的。根据应用方式它以 3 种不同的模式工作。<br>● 运转模式：调节器以正常功耗模式提供 1.8V 电源 (内核，内存和外设)。<br>● 停止模式：调节器以低功耗模式提供 1.8V 电源，以保存寄存器和 SRAM 的内容。<br>● 待机模式：调节器停止供电。除了备用电路和备份域外，寄存器和 SRAM 的内容全部丢失。</p><h3 id="132-电源管理"><a class="anchor" href="#132-电源管理">#</a> 1.3.2| 电源管理</h3><h4 id="pvd可编程电压检测器"><a class="anchor" href="#pvd可编程电压检测器">#</a> PVD (可编程电压检测器)</h4><p>用户可以利用 PVD 对 V<sub>DD</sub> 电压与电源控制寄存器 (PWR_CR) 中的 PLS [2:0] 位进行比较来监控电源，这几位选择监控电压的阀值。通过设置 PVDE 位来使能 PVD。<br>电源控制 / 状态寄存器 (PWR_CSR) 中的 PVDO 标志用来表明 V <sub>DD</sub> 是高于还是低于 PVD 的电压阀值。该事件在内部连接到外部中断的第 16 线，如果该中断在外部中断寄存器中是使能的，该事件就会产生中断。当 V DD 下降到 PVD 阀值以下和 (或) 当 V DD 上升到 PVD 阀值之上时，根据外部中断第 16 线的上升 / 下降边沿触发设置，就会产生 PVD 中断。例如，这一特性可用于用于执行紧急关闭任务</p><p><img data-src="https://gitee.com/junwide/blog/raw/master/20200628004327.png" alt=""></p><p>识别电压是否下降到安全电压以下，电压正常时程序进行其他任务的运行；电压异常时程序进行保护模式，对相关寄存器、外设进行保护操作。这种方法会占用 MCU 的处理时间，同时使用 ADC 增加了系统的功耗</p><figure class="highlight c"><figcaption data-lang="c"><span>PVD null null</span></figcaption><table><tr><td data-num="1"></td><td><pre>#系统启动后启动PVD，并开启相应的中断</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">PWR_PVDLevelConfig</span><span class="token punctuation">(</span>PWR_PVDLevel_2V8<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设定监控阀值</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">PWR_PVDCmd</span><span class="token punctuation">(</span>ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 使能 PVD</span></pre></td></tr><tr class="marked"><td data-num="4"></td><td><pre><span class="token function">EXTI_StructInit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>EXTI_InitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr class="marked"><td data-num="5"></td><td><pre>EXTI_InitStructure<span class="token punctuation">.</span>EXTI_Line <span class="token operator">=</span> EXTI_Line16<span class="token punctuation">;</span> <span class="token comment">// PVD 连接到中断线 16 上</span></pre></td></tr><tr class="marked"><td data-num="6"></td><td><pre>EXTI_InitStructure<span class="token punctuation">.</span>EXTI_Mode <span class="token operator">=</span> EXTI_Mode_Interrupt<span class="token punctuation">;</span> <span class="token comment">// 使用中断模式</span></pre></td></tr><tr><td data-num="7"></td><td><pre>EXTI_InitStructure<span class="token punctuation">.</span>EXTI_Trigger <span class="token operator">=</span> EXTI_Trigger_Raising<span class="token punctuation">;</span><span class="token comment">// 电压低于阀值时产生中断</span></pre></td></tr><tr><td data-num="8"></td><td><pre>EXTI_InitStructure<span class="token punctuation">.</span>EXTI_LineCmd <span class="token operator">=</span> ENABLE<span class="token punctuation">;</span> <span class="token comment">// 使能中断线</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token function">EXTI_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>EXTI_InitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 初始化中断控制器</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">/* 当工作电压低于设定阀值时，将产生一个中断，在中断程序中进行相应的处理：*/</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">void</span> <span class="token function">PVD_IRQHandler</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token function">EXTI_ClearITPendingBit</span><span class="token punctuation">(</span>EXTI_Line16<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>… … <span class="token comment">// 用户添加紧急处理代码处</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="133-低功耗"><a class="anchor" href="#133-低功耗">#</a> 1.33| 低功耗</h3><hr><p>在系统或电源复位以后，微控制器处于运行状态。当 CPU 不需继续运行时，可以利用多种低功耗模式来节省功耗，例如等待某个外部事件时。用户需要根据最低电源消耗、最快速启动时间和可用的唤醒源等条件，选定一个最佳的低功耗模式。</p><ol><li><p><strong>睡眠状态</strong></p></li><li><p><strong>停止状态</strong></p></li><li><p><strong>待机状态</strong></p><p><img data-src="https://gitee.com/junwide/blog/raw/master/20200628004413.png" alt=""></p><blockquote><p>在待机模式下，所有 IO 口引脚处于高阻状态，除了以下一些情况：</p><ul><li>复位引脚 (始终有效)；</li><li>防侵入引脚，如果被设置为检测侵入或校准；</li><li>唤醒引脚，如果使能</li></ul><p>唤醒源：</p><ul><li>唤醒引脚的上升沿</li><li>RTC 警告</li></ul></blockquote></li></ol><blockquote><ul><li>复位引脚外部复位信号</li><li>IWDG 复位</li></ul></blockquote><figure class="highlight c"><figcaption data-lang="c"><span>睡眠模式 null null</span></figcaption><table><tr><td data-num="1"></td><td><pre>#进入睡眠模式的代码：</pre></td></tr><tr><td data-num="2"></td><td><pre>＃define <span class="token function">SysCtrl_SLEEPONEXIT_Set</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>u32<span class="token punctuation">)</span><span class="token number">0x00000002</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">void</span> <span class="token function">PWR_EnterSLEEPMode</span><span class="token punctuation">(</span>u32 SysCtrl_Set<span class="token punctuation">,</span> u8 PWR_SLEEPEntry<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span>SysCtrl_Set<span class="token punctuation">)</span> <span class="token comment">// 对 Cortex-M3 中系统控制寄存器的 SLEEPONEXIT 位置位</span></pre></td></tr><tr><td data-num="5"></td><td><pre>		<span class="token operator">*</span><span class="token punctuation">(</span>vu32 <span class="token operator">*</span><span class="token punctuation">)</span> SCB_SysCtrl <span class="token operator">|=</span> SysCtrl_SLEEPONEXIT_Set<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token keyword">else</span> <span class="token comment">// 对 Cortex-M3 中系统控制寄存器的 SLEEPONEXIT 位复位</span></pre></td></tr><tr><td data-num="7"></td><td><pre>		<span class="token operator">*</span><span class="token punctuation">(</span>vu32 <span class="token operator">*</span><span class="token punctuation">)</span> SCB_SysCtrl <span class="token operator">&amp;=</span> <span class="token operator">~</span>SysCtrl_SLEEPONEXIT_Set<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>		<span class="token comment">// 对 Cortex-M3 中系统控制寄存器的 SLEEPDEEP 位复位</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	<span class="token operator">*</span><span class="token punctuation">(</span>vu32 <span class="token operator">*</span><span class="token punctuation">)</span> SCB_SysCtrl <span class="token operator">&amp;=</span> <span class="token operator">~</span>SysCtrl_SLEEPDEEP_Set<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span>PWR_SLEEPEntry <span class="token operator">==</span> PWR_SLEEPEntry_WFI<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>		<span class="token function">__WFI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 等待中断请求</span></pre></td></tr><tr><td data-num="12"></td><td><pre>	<span class="token keyword">else</span></pre></td></tr><tr><td data-num="13"></td><td><pre>		<span class="token function">__WFE</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 等待事件请求</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>#进入停止模式的代码</pre></td></tr><tr><td data-num="17"></td><td><pre>#使能PWR的时钟</pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">void</span> <span class="token function">PWR_EnterSTOPMode</span><span class="token punctuation">(</span>u32 PWR_Regulator<span class="token punctuation">,</span> u8 PWR_STOPEntry<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>	PWR<span class="token operator">-></span>CR <span class="token operator">&amp;=</span> CR_DS_Mask<span class="token punctuation">;</span> <span class="token comment">// 清除 PDDS 和 LPDS 位</span></pre></td></tr><tr><td data-num="21"></td><td><pre>	PWR<span class="token operator">-></span>CR <span class="token operator">|=</span> PWR_Regulator<span class="token punctuation">;</span> <span class="token comment">// 根据 PWR_Regulator 的值设置 LPDS 位</span></pre></td></tr><tr><td data-num="22"></td><td><pre>	<span class="token operator">*</span><span class="token punctuation">(</span>vu32 <span class="token operator">*</span><span class="token punctuation">)</span> SCB_SysCtrl <span class="token operator">|=</span> SysCtrl_SLEEPDEEP_Set<span class="token punctuation">;</span> <span class="token comment">// 置位 SLEEPDEEP 位</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token comment">// 选择进入 STOP 模式的入口</span></pre></td></tr><tr><td data-num="24"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span>PWR_STOPEntry <span class="token operator">==</span> PWR_STOPEntry_WFI<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre>		<span class="token function">__WFI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 请求等待中断</span></pre></td></tr><tr><td data-num="26"></td><td><pre>	<span class="token keyword">else</span></pre></td></tr><tr><td data-num="27"></td><td><pre>		<span class="token function">__WFE</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 请求等待事件</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre>#进入待机模式</pre></td></tr><tr><td data-num="31"></td><td><pre></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token keyword">void</span> <span class="token function">PWR_EnterSTANDBYMode</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>	PWR<span class="token operator">-></span>CR <span class="token operator">|=</span> CR_CWUF_Set<span class="token punctuation">;</span> <span class="token comment">// 清除 Wake-up 标志</span></pre></td></tr><tr><td data-num="35"></td><td><pre>	PWR<span class="token operator">-></span>CR <span class="token operator">|=</span> CR_PDDS_Set<span class="token punctuation">;</span> <span class="token comment">// 选择进入 STANDBY 模式</span></pre></td></tr><tr><td data-num="36"></td><td><pre>	<span class="token comment">// 置位 SLEEPDEEP 位</span></pre></td></tr><tr><td data-num="37"></td><td><pre>	<span class="token operator">*</span><span class="token punctuation">(</span>vu32 <span class="token operator">*</span><span class="token punctuation">)</span> SCB_SysCtrl <span class="token operator">|=</span> SysCtrl_SLEEPDEEP_Set<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>	<span class="token function">__WFI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 等待中断请求</span></pre></td></tr><tr><td data-num="39"></td><td><pre> <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>除了低功耗模式可以通过</p><ul><li>降低时钟频率</li><li>关闭 APB 和 AHB 上的外设时钟</li></ul><h4 id="低功耗模式下的awu"><a class="anchor" href="#低功耗模式下的awu">#</a> 低功耗模式下的 AWU</h4><p>RTC 可以在不需要依赖外部中断的情况下唤醒低功耗模式下的微控制器 (自动唤醒模式)。RTC 提供一个可编程的时间基数，用于周期性从停止或待机模式下唤醒。通过对备份区域控制寄存器 (RCC_BDCR) 的 RTCSEL [1:0] 位的编程，三个 RTC 时钟源中的二个时钟源可以选作实现功能。</p><h2 id="14-复位和时钟控制"><a class="anchor" href="#14-复位和时钟控制">#</a> 1.4| 复位和时钟控制</h2><p><img data-src="https://gitee.com/junwide/blog/raw/master/20200628004447.png" alt=""></p><h3 id="141-系统复位"><a class="anchor" href="#141-系统复位">#</a> 1..4.1| 系统复位</h3><p>当以下事件中的一件发生时，产生一个系统复位：</p><ul><li><p>NRST 引脚上的低电平 (外部复位)</p></li><li><p>窗口看门狗计数终止 (WWDG 复位)</p></li><li><p>独立看门狗计数终止 (IWDG 复位)</p></li><li><p>软件复位 (SW 复位)</p></li><li><p>低功耗管理复位</p></li></ul><h3 id="142-电源复位"><a class="anchor" href="#142-电源复位">#</a> 1.4.2| 电源复位</h3><p>当以下事件中之一发生时，产生电源复位：</p><ul><li><p>上电 / 掉电复位 (POR/PDR 复位)</p></li><li><p>从待机模式中返回</p></li></ul><p><img data-src="https://gitee.com/junwide/blog/raw/master/20200628004507.png" alt=""></p><p><img data-src="https://gitee.com/junwide/blog/raw/master/20200628004530.png" alt=""></p><p><img data-src="https://gitee.com/junwide/blog/raw/master/20200628004540.png" alt=""></p><h3 id="143-时钟类型"><a class="anchor" href="#143-时钟类型">#</a> 1.4.3| 时钟类型</h3><h4 id="hes时钟"><a class="anchor" href="#hes时钟">#</a> HES 时钟</h4><ul><li><p>HSE 外部晶体 / 陶瓷谐振器</p></li><li><p>HSE 用户外部时钟</p></li></ul><blockquote><p>为了减少时钟输出的失真和缩短启动稳定时间，晶体 / 陶瓷谐振器和负载电容器必须尽可能地靠近振荡器引脚。负载电容值必须根据所选择的振荡器来调整。</p></blockquote><p><img data-src="https://gitee.com/junwide/blog/raw/master/20200628004614.png" alt=""></p><blockquote><p>外部时钟源 (HSE 旁路) 在这个模式里，必须提供外部时钟。它的频率最高可达 50MHz。</p></blockquote><h4 id="hsi-时钟"><a class="anchor" href="#hsi-时钟">#</a> HSI 时钟</h4><p>HSI 时钟信号由内部 8MHz 的 RC 振荡器产生，可直接作为系统时钟或在 2 分频后作为 PLL 输入。HSI RC 振荡器能够在不需要任何外部器件的条件下提供系统时钟。它的启动时间比 HSE 晶体振荡器短。然而，即使在校准之后它的时钟频率精度仍较差</p><h4 id="lse-时钟"><a class="anchor" href="#lse-时钟">#</a> LSE 时钟</h4><p>LSE 晶体是一个 32.768kHz 的低速外部晶体或陶瓷谐振器。它为实时时钟或者其他定时功能提供一个低功耗且精确的时钟源。</p><h4 id="lsi-时钟"><a class="anchor" href="#lsi-时钟">#</a> LSI 时钟</h4><p>LSI RC 担当一个低功耗时钟源的角色，它可以在停机和待机模式下保持运行，为独立看门狗和自动唤醒单元提供时钟。LSI 时钟频率大约 40kHz (在 30kHz 和 60kHz 之间)。</p><blockquote><p>可以通过校准内部低速振荡器 LSI 来补偿其频率偏移，从而获得精度可接受的 RTC 时间基数，以及独立看门狗 (IWDG) 的超时时间 (当这些外设以 LSI 为时钟源)。校准可以通过使用 TIM5 的输入时钟 (TIM5_CLK) 测量 LSI 时钟频率实现。测量以 HSE 的精度为保证，软件可以通过调整 RTC 的 20 位预分频器来获得精确的 RTC 时钟基数，以及通过计算得到精确的独立看门狗 (IWDG) 的超时时间。</p><p>LSI 校准步骤如下：</p><ol><li>打开 TIM5，设置通道 4 为输入捕获模式；</li><li>设置 AFIO_MAPR 的 TIM5_CH4_IREMAP 位为’1’，在内部把 LSI 连接到 TIM5 的通道 4；</li><li>通过 TIM5 的捕获 / 比较 4 事件或者中断来测量 LSI 时钟频率；</li><li>根据测量结果和期望的 RTC 时间基数和独立看门狗的超时时间，设置 20 位预分频器。</li></ol></blockquote><h4 id="css"><a class="anchor" href="#css">#</a> CSS</h4><p>时钟安全系统被激活后，时钟监控器将实时监控外部高速振荡器；如果 HSE 时钟发生故障，外部振荡器自动被关闭，产生时钟安全中断，<br>此中断被连接到 Cortex-M3 的 NMI 的中断；与此同时 CSS 将内部 RC 振荡器切换为 STM32 的系统时钟源</p><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre>#启动时钟安全系统CSS：</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">RCC_ClockSecuritySystemCmd</span><span class="token punctuation">(</span>ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//(NMI 中断是不可屏蔽的！)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>#外部振荡器实现时，产生中断，对应的中断程序：</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">void</span> <span class="token function">NMIException</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">RCC_GetITStatus</span><span class="token punctuation">(</span>RCC_IT_CSS<span class="token punctuation">)</span> <span class="token operator">!=</span> RESET<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>		<span class="token punctuation">&#123;</span> 	<span class="token comment">// HSE、PLL 已被禁止 (但是 PLL 设置未变)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        	<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token comment">// 客户添加相应的系统保护代码处</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>        	<span class="token comment">// 下面为 HSE 恢复后的预设置代码</span></pre></td></tr><tr><td data-num="11"></td><td><pre>			<span class="token function">RCC_HSEConfig</span><span class="token punctuation">(</span>RCC_HSE_ON<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 使能 HSE</span></pre></td></tr><tr><td data-num="12"></td><td><pre>			<span class="token function">RCC_ITConfig</span><span class="token punctuation">(</span>RCC_IT_HSERDY<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 使能 HSE 就绪中断</span></pre></td></tr><tr><td data-num="13"></td><td><pre>			<span class="token function">RCC_ITConfig</span><span class="token punctuation">(</span>RCC_IT_PLLRDY<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 使能 PLL 就绪中断</span></pre></td></tr><tr><td data-num="14"></td><td><pre>			<span class="token function">RCC_ClearITPendingBit</span><span class="token punctuation">(</span>RCC_IT_CSS<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 清除时钟安全系统中断的挂起位</span></pre></td></tr><tr><td data-num="15"></td><td><pre>			<span class="token comment">// 至此，一旦 HSE 时钟恢复，将发生 HSERDY 中断，在 RCC 中断处理程序里，系统时钟可以设置到以前的状态</span></pre></td></tr><tr><td data-num="16"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h4 id="rtc时钟"><a class="anchor" href="#rtc时钟">#</a> RTC 时钟</h4><p>实时时钟是一个独立的定时器。RTC 模块拥有一组连续计数的计数器，在相应软件配置下，可提供时钟日历的功能。修改计数器的值可以重新设置系统当前的时间和日期。RTC 模块和时钟配置系统 (RCC_BDCR 寄存器) 处于后备区域，即在系统复位或从待机模式唤醒后，RTC 的设置和时间维持不变。</p><p>可以选择以下三种 RTC 的时钟源:</p><ul><li>HSE 时钟除以 128</li><li>LSE 振荡器时钟</li><li>LSI 振荡器时钟</li></ul><p>3 个专门的可屏蔽中断：</p><ul><li>闹钟中断，用来产生一个软件可编程的闹钟中断。</li><li>秒中断，用来产生一个可编程的周期性中断信号 (最长可达 1 秒)。</li><li>溢出中断，指示内部可编程计数器溢出并回转为 0 的状态</li></ul><h4 id="系统时钟"><a class="anchor" href="#系统时钟">#</a> 系统时钟</h4><p>系统复位后，HSI 振荡器被选为系统时钟。当时钟源被直接或通过 PLL 间接作为系统时钟时，它将不能被停止。</p><p>只有当目标时钟源准备就绪了 (经过启动稳定阶段的延迟或 PLL 稳定)，从一个时钟源到另一个时钟源的切换才会发生。在被选择时钟源没有就绪时，系统时钟的切换不会发生。直至目标时钟源就绪，才发生切换。</p><p>在时钟控制寄存器 (RCC_CR) 里的状态位指示哪个时钟已经准备好了，哪个时钟目前被用作系统时钟</p><blockquote><p>应用：精确延时</p><p>使用 Cortex-M3 内核的 SYSTICK 作为定时时钟，设定每一毫秒产生一次中断，在中断处理函数里对 N 减一，在 Delay (N) 函数中循环检<br>测 N 是否为 0，不为 0 则进行循环等待；若为 0 则关闭 SYSTISK 时钟，退出函数</p><p>条件：</p><ol><li>外部晶振为 8MHz</li><li>系统时钟为 72MHz</li><li>SYSTICK 的频率 9MHz 产生 1ms 的中断。</li></ol></blockquote><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre>SysTick_SetR <span class="token function">eload</span><span class="token punctuation">(</span><span class="token number">9000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 设定 SysTick 达到 1ms 计数结束</span></pre></td></tr><tr><td data-num="2"></td><td><pre>SysTick_ITConf <span class="token function">ig</span><span class="token punctuation">(</span>ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 使能 SysTick 中断</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>#中断处理函数</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">void</span> SysTickHa <span class="token function">ndler</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span>TimingDelay<span class="token operator">!=</span> <span class="token number">0x00</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        TimingDelay<span class="token operator">--</span><span class="token punctuation">;</span>     <span class="token comment">// 全局变量 TimingDelay 必须定义为 volatile</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">void</span> <span class="token function">Delay</span><span class="token punctuation">(</span>u <span class="token number">32</span> nTime<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	SysTick_CounterCm <span class="token function">d</span><span class="token punctuation">(</span>SysTick_Coun ter_Enable<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 使能 SysTick 计数器</span></pre></td></tr><tr><td data-num="12"></td><td><pre>	TimingDelay <span class="token operator">=</span> nTime<span class="token punctuation">;</span><span class="token comment">// 读取延时时间</span></pre></td></tr><tr><td data-num="13"></td><td><pre>	<span class="token keyword">while</span><span class="token punctuation">(</span>TimingDelay<span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 判断延时是否结束</span></pre></td></tr><tr><td data-num="14"></td><td><pre>	SysTick_CounterCm <span class="token function">d</span><span class="token punctuation">(</span>SysTick_Coun ter_Disable<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 关闭 SysTick 计数器</span></pre></td></tr><tr><td data-num="15"></td><td><pre>	<span class="token function">SysTick_CounterCmd</span><span class="token punctuation">(</span>Sy sTick_Counter_Clear<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 清除 SysTick 计数器</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h4 id="时钟输出"><a class="anchor" href="#时钟输出">#</a> 时钟输出</h4><p>微控制器允许输出时钟信号到外部 MCO 引脚。<br>相应的 GPIO 端口寄存器必须被配置为相应功能。以下 8 个时钟信号可被选作 MCO 时钟：<br>● SYSCLK<br>● HSI<br>● HSE<br>● 除 2 的 PLL 时钟<br>● PLL2 时钟<br>● PLL3 时钟除以 2<br>● XT1 外部 3~25MHz 振荡器 (用于以太网)<br>● PLL3 时钟 (用于以太网)</p><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre>#设置PA<span class="token punctuation">.</span><span class="token number">8</span>为复用Push<span class="token operator">-</span>Pull模式。</pre></td></tr><tr><td data-num="2"></td><td><pre>GPIO_InitStructure<span class="token punctuation">.</span>GPIO_Pin <span class="token operator">=</span> GPIO_Pin_8<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>GPIO_InitStructure<span class="token punctuation">.</span>GPIO_Speed <span class="token operator">=</span> GPIO_Speed_50MHz<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>GPIO_InitStructure<span class="token punctuation">.</span>GPIO_Mode <span class="token operator">=</span> GPIO_Mode_AF_PP<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token function">GPIO_Init</span><span class="token punctuation">(</span>GPIOA<span class="token punctuation">,</span> <span class="token operator">&amp;</span>GPIO_InitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>#输出时钟：</pre></td></tr><tr><td data-num="7"></td><td><pre>#时钟的选择由时钟配置寄存器<span class="token punctuation">(</span>RCC_CFGR<span class="token punctuation">)</span>中的MCO<span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span>位控制。</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token function">RCC_MCOConfig</span><span class="token punctuation">(</span>RCC_MCO<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>#参数RCC_MCO为要输出的内部时钟：</pre></td></tr><tr><td data-num="10"></td><td><pre>RCC_MCO_NoClock <span class="token comment">//--- 无时钟输出</span></pre></td></tr><tr><td data-num="11"></td><td><pre>RCC_MCO_SYSCLK  <span class="token comment">//--- 输出系统时钟（SysCLK）</span></pre></td></tr><tr><td data-num="12"></td><td><pre>RCC_MCO_HSI     <span class="token comment">//--- 输出内部高速 8MHz 的 RC 振荡器的时钟（HSI）</span></pre></td></tr><tr><td data-num="13"></td><td><pre>RCC_MCO_HSE     <span class="token comment">//--- 输出高速外部时钟信号（HSE）</span></pre></td></tr><tr><td data-num="14"></td><td><pre>RCC_MCO_PLLCLK_Div2   <span class="token comment">//--- 输出 PLL 倍频后的二分频时钟（PLLCLK/2）</span></pre></td></tr></table></figure><h2 id="15-dma"><a class="anchor" href="#15-dma">#</a> 1.5| DMA</h2><p>直接存储器存取 (DMA) 用来提供在外设和存储器之间或者存储器和存储器之间的高速数据传输。无须 CPU 干预，数据可以通过 DMA 快速地移动，这就节省了 CPU 的资源来做其他操作。两个 DMA 控制器有 12 个通道 (DMA1 有 7 个通道，DMA2 有 5 个通道)，每个通道专门用来管理来自于一个或多个外设对存储器访问的请求。还有一个仲裁器来协调各个 DMA 请求的优先权。</p><p><img data-src="https://gitee.com/junwide/blog/raw/master/20200628004742.png" alt=""></p><p><img data-src="https://gitee.com/junwide/blog/raw/master/20200628004755.png" alt=""></p><p><strong>三大因素</strong></p><ul><li>传输源：DMA 控制器从传输源读出数据；</li><li>传输目标：DMA 控制器将数据传输的目标；</li><li>触发信号：用于触发一次数据传输的动作，执行一个单位的传输源至传输目标的数据传输；可以用来控制传输的时机</li></ul><h3 id="151-dma处理"><a class="anchor" href="#151-dma处理">#</a> 1.5.1| DMA 处理</h3><p>在发生一个事件后，外设向 DMA 控制器发送一个请求信号。DMA 控制器根据通道的优先权处理请求。当 DMA 控制器开始访问发出请求的外设时，DMA 控制器立即发送给它一个应答信号。当从 DMA 控制器得到应答信号时，外设立即释放它的请求。一旦外设释放了这个请求，DMA 控制器同时撤销应答信号。如果有更多的请求时，外设可以启动下一个周期。</p><h3 id="152-仲裁器"><a class="anchor" href="#152-仲裁器">#</a> 1.5.2| 仲裁器</h3><p>仲裁器根据通道请求的优先级来启动外设 / 存储器的访问。</p><p><img data-src="https://gitee.com/junwide/blog/raw/master/20200628004916.png" alt=""></p><h3 id="153-实例"><a class="anchor" href="#153-实例">#</a> 1.5.3| 实例</h3><p><img data-src="https://gitee.com/junwide/blog/raw/master/20200628004931.png" alt=""></p><h2 id="16-gpio"><a class="anchor" href="#16-gpio">#</a> 1.6| GPIO</h2><h3 id="161-工作模式"><a class="anchor" href="#161-工作模式">#</a> 1.6.1| 工作模式</h3><h4 id="单向"><a class="anchor" href="#单向">#</a> 单向</h4><p>输入:</p><ul><li>输入浮空</li><li>输入上拉</li><li>输入下拉</li></ul><p>输出:</p><ul><li>开漏输出</li></ul><p><img data-src="https://gitee.com/junwide/blog/raw/master/20200628005005.png" alt=""></p><ul><li>推挽式输出</li></ul><p><img data-src="https://gitee.com/junwide/blog/raw/master/20200628005015.png" alt=""></p><blockquote><ol><li>推挽输出能够输出高或者低，而开漏输出只能输出低，或者关闭输出，因此开漏输出总是要配一个上拉电阻使用。</li><li>开漏输出的上拉电阻不能太小，太小的话，当开漏输出的下管导通时，电源到地的电压在电阻上会造成很大的功耗，因此这个阻阻值通常在 10k 以上，这样开漏输出在从输出低电平切换到高电平时，速度是很慢的</li><li>推挽输出任意时刻的输出要么是高，要么是低，所以不能将多个输出线接，而开漏输出可以将多个输出线接，共用一个上拉此时这些开漏输出的驱动其实是与非的关系</li><li>推挽输出输出高时，其电压等于推挽电路的电源，通常为一个定值，而开漏输出的高取决于上拉电阻接的电压，不取决于前级电压，所以经常用来做电平转换，用低电压逻辑驱动高电压逻辑，比如 3.3v 带 5v</li></ol></blockquote><h4 id="双向"><a class="anchor" href="#双向">#</a> 双向</h4><p>总线握手</p><h4 id="模拟信号输入输出"><a class="anchor" href="#模拟信号输入输出">#</a> 模拟信号输入输出</h4><h3 id="162-io的连接"><a class="anchor" href="#162-io的连接">#</a> 1.6.2| IO 的连接</h3><h4 id="单向传输"><a class="anchor" href="#单向传输">#</a> 单向传输</h4><p>输入</p><ul><li>使用专用芯片 (ST1G3234，74LVC2t45 等)，或使用分立器件</li><li>对于可承受 5V 的 STM32 I/O，可直接连接</li></ul><p>输出</p><ul><li>使用专用芯片 (ST1G3234，74LVC2t45 等) ，或使用分立器件</li><li>如对方可兼容 TTL，可考虑直接连接</li><li>对于可承受 5V 的 STM32 I/O，可使用开漏输出上拉电阻连接</li></ul><h4 id="双向握手"><a class="anchor" href="#双向握手">#</a> 双向握手</h4><ul><li>使用专用芯片 (MAX3378 等) ，或使用分立器件</li><li>对于可承受 5V 的 STM32 I/O 端口，可使用开漏输出加上拉电阻连接</li></ul><h3 id="163-重映射"><a class="anchor" href="#163-重映射">#</a> 1.6.3| 重映射</h3><h4 id="重映射和好处"><a class="anchor" href="#重映射和好处">#</a> 重映射和好处</h4><ul><li>I/O 的复用：GPIO 和内置外设共用引出管脚</li><li>I/O 的重映射：复用功能 (AFIO) 从不同的 GPIO 管脚引出</li><li>方便了 PCB 的设计，潜在地减少了信号的交叉干扰</li><li>分时复用某些外设，虚拟地增加了端口数目</li></ul><h4 id="重映射的步骤"><a class="anchor" href="#重映射的步骤">#</a> 重映射的步骤</h4><ol><li>使能被重新映射到的 I/O 端口时钟</li><li>使能被重新映射的外设时钟</li><li>使能 AFIO 功能的时钟</li><li>进行重映射</li></ol><h4 id="实例"><a class="anchor" href="#实例">#</a> 实例</h4><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token expression">USART2的TX<span class="token operator">/</span>RX在PA<span class="token punctuation">.</span><span class="token number">2</span><span class="token operator">/</span><span class="token number">3</span></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token expression">PA<span class="token punctuation">.</span><span class="token number">2</span>已经被Timer2的channel3使用</span></span></pre></td></tr><tr><td data-num="3"></td><td><pre>#需要把USART2的TX<span class="token operator">/</span>RX重映射到PD<span class="token punctuation">.</span><span class="token number">5</span><span class="token operator">/</span><span class="token number">6</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">//(1) 使能被重新映射到的 I/O 端口时钟</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token function">RCC_APB2PeriphClockCmd</span><span class="token punctuation">(</span>RCC_APB2Periph_GPIOD<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">//(2) 使能被重新映射的外设时钟</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token function">RCC_APB1PeriphClockCmd</span><span class="token punctuation">(</span>RCC_APB1Periph_USART2<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment">//(3) 使能 AFIO 功能的时钟</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token function">RCC_APB2PeriphClockCmd</span><span class="token punctuation">(</span>RCC_APB2Periph_AFIO<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">//(4) 进行重映射</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token function">GPIO_PinRemapConfig</span><span class="token punctuation">(</span>GPIO_Remap_USART2<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="164-sdio"><a class="anchor" href="#164-sdio">#</a> 1.6.4| SDIO</h3><p>待更新</p><h2 id="参考文献"><a class="anchor" href="#参考文献">#</a> 参考文献</h2><p>[1] Clarence. 浅谈单片机特征和选型 [EB/OL].<span class="exturl" data-url="aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC82NzY4MTgzMiwyMDE5LTUtMzE=">https://zhuanlan.zhihu.com/p/67681832,2019-5-31</span>.<br>[2] 上海利邦高技术有限公司。单片机选型指南 [M]. 上海利邦高技术有限公司：上海，2019:1.<br>[3] 陈小挺.stm32 中的 “位带操作” 浅析 [EB/OL].<span class="exturl" data-url="aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC8yMjkzNTM1NCwyMDE3LTAyLTA2">https://zhuanlan.zhihu.com/p/22935354,2017-02-06</span>.<br>[4] 阏男秀。如何正确的理解漏极开路输出跟推挽输出？[EB/OL].<span class="exturl" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3F1ZXN0aW9uLzI4NTEyNDMyLDIwMTctMDMtMTU=">https://www.zhihu.com/question/28512432,2017-03-15</span>.<br>[5] well xiong. 如何正确的理解漏极开路输出跟推挽输出？[EB/OL].<span class="exturl" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3F1ZXN0aW9uLzI4NTEyNDMyLDIwMTYtMDYtMTc=">https://www.zhihu.com/question/28512432,2016-06-17</span>.<br>[6] ST.STM32 中文手册 [M/CD].ST 公司，2019-1-1.<br>[7] ARM.Cortex 权威指南 [M/CD].ST,2015-1-1.</p><div class="tags"><a href="/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/" rel="tag"><i class="ic i-tag"></i> 嵌入式</a> <a href="/tags/ARM/" rel="tag"><i class="ic i-tag"></i> ARM</a> <a href="/tags/STM32/" rel="tag"><i class="ic i-tag"></i> STM32</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2021-04-18 20:43:31" itemprop="dateModified" datetime="2021-04-18T20:43:31+08:00">2021-04-18</time></span></div><div id="lv-container" data-id="city" data-uid="MTAyMC80MzY4Ni8yMDIyNg=="><script type="text/javascript">!function(e,t){var n,c=e.getElementsByTagName(t)[0];"function"!=typeof LivereTower&&(n=e.createElement(t),n.src="https://cdn-city.livere.com/js/embed.dist.js",n.async=!0,c.parentNode.insertBefore(n,c))}(document,"script")</script><noscript>为正常使用来必力评论功能请激活JavaScript</noscript></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="Junwide Xiao 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="Junwide Xiao 支付宝"><p>支付宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>Junwide Xiao <i class="ic i-at"><em>@</em></i>精神小伙</li><li class="link"><strong>本文链接：</strong> <a href="https://junwide.github.io/embed-system/MCU%E4%B8%8E%E5%B5%8C%E5%85%A5%E5%BC%8F-%E5%9F%BA%E7%A1%80%E6%A6%82%E7%8E%871/" title="01| MCU与嵌入式:基础概率">https://junwide.github.io/embed-system/MCU与嵌入式-基础概率1/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/normal-Skill/Remote%20Work/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;gitee.com&#x2F;junwide&#x2F;blog&#x2F;raw&#x2F;master&#x2F;20210418104513.jpg" title="Remote Work"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> 其他技巧</span><h3>Remote Work</h3></a></div><div class="item right"><a href="/embed-system/%E7%AE%80%E5%8D%95MCU%E8%AF%BE%E8%AE%BE%E5%BC%80%E6%BA%90--%E7%94%B5%E5%AD%90%E9%92%9F/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;gitee.com&#x2F;junwide&#x2F;blog&#x2F;raw&#x2F;master&#x2F;20210418104627.jpg" title="简单MCU课设开源--电子钟"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> 嵌入式系统</span><h3>简单MCU课设开源--电子钟</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#01-mcu%E4%B8%8E%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%9F%BA%E7%A1%80%E6%A6%82%E7%8E%87"><span class="toc-number">1.</span> <span class="toc-text">01| MCU 与嵌入式：基础概率</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#11-%E9%80%89%E5%9E%8B%E5%92%8C%E6%AF%94%E8%BE%83"><span class="toc-number">1.1.</span> <span class="toc-text">1.1| 选型和比较</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11-%E7%89%B9%E6%80%A7%E6%AF%94%E8%BE%83"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.1| 特性比较</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B8%A9%E5%BA%A6%E7%89%B9%E6%80%A7"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">温度特性：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%8E%E5%8A%9F%E8%80%97%E7%89%B9%E6%80%A7"><span class="toc-number">1.1.1.2.</span> <span class="toc-text">低功耗特性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8A%AF%E7%89%87%E7%83%AD%E5%BA%A6"><span class="toc-number">1.1.1.3.</span> <span class="toc-text">芯片热度</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83"><span class="toc-number">1.1.1.4.</span> <span class="toc-text">开发环境</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%97%E5%B9%B2%E6%89%B0%E6%80%A7"><span class="toc-number">1.1.1.5.</span> <span class="toc-text">抗干扰性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.1.1.6.</span> <span class="toc-text">操作系统</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#no-os"><span class="toc-number">1.1.1.6.1.</span> <span class="toc-text">No-OS</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%9E%E6%97%B6%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.1.1.6.2.</span> <span class="toc-text">实时操作系统</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%81%E8%A3%85"><span class="toc-number">1.1.1.7.</span> <span class="toc-text">封装</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-%E6%9E%B6%E6%9E%84%E5%88%86%E5%B8%83arm%E4%B8%BA%E4%BE%8B"><span class="toc-number">1.1.2.</span> <span class="toc-text">1.2| 架构分布（ARM 为例）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#cortex-m3"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">Cortex-M3</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mpumemory-protect-unit"><span class="toc-number">1.1.2.2.</span> <span class="toc-text">MPU（Memory Protect Unit）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#fpufoating-point-unit"><span class="toc-number">1.1.2.3.</span> <span class="toc-text">FPU(Foating point unit)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-%E5%AD%98%E5%82%A8%E5%99%A8%E5%92%8C%E6%80%BB%E7%BA%BF%E6%9E%B6%E6%9E%84"><span class="toc-number">1.2.</span> <span class="toc-text">1.2| 存储器和总线架构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#121-%E5%AD%98%E5%82%A8%E5%99%A8%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84"><span class="toc-number">1.2.1.</span> <span class="toc-text">1.2.1| 存储器整体架构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#i-code-%E6%80%BB%E7%BA%BF"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">I-Code 总线</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#d-code-%E6%80%BB%E7%BA%BF"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">D-Code 总线</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E6%80%BB%E7%BA%BF"><span class="toc-number">1.2.1.3.</span> <span class="toc-text">系统总线</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dma-%E6%80%BB%E7%BA%BF"><span class="toc-number">1.2.1.4.</span> <span class="toc-text">DMA 总线</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BA%BF%E7%9F%A9%E9%98%B5"><span class="toc-number">1.2.1.5.</span> <span class="toc-text">总线矩阵</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ahbapb-%E6%A1%A5apb"><span class="toc-number">1.2.1.6.</span> <span class="toc-text">AHB&#x2F;APB 桥 (APB)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#122-%E5%AD%98%E5%82%A8%E5%99%A8%E7%9A%84%E6%98%A0%E5%83%8F"><span class="toc-number">1.2.2.</span> <span class="toc-text">1.2.2| 存储器的映像</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%98%A0%E5%B0%84%E8%A1%A8%E8%A7%81%E6%89%8B%E5%86%8C"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">映射表 (见手册)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%8D%E5%B8%A6%E6%93%8D%E4%BD%9C"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">位带操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#fsmc"><span class="toc-number">1.2.2.3.</span> <span class="toc-text">FSMC</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#123-crc%E8%AE%A1%E7%AE%97%E5%8D%95%E5%85%83"><span class="toc-number">1.2.3.</span> <span class="toc-text">1.2.3| CRC 计算单元</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-%E7%94%B5%E6%BA%90%E6%8E%A7%E5%88%B6"><span class="toc-number">1.3.</span> <span class="toc-text">1.3| 电源控制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#131-%E7%94%B5%E6%BA%90%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.3.1.</span> <span class="toc-text">1.3.1| 电源系统</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%B5%E5%8E%8B%E8%B0%83%E8%8A%82%E5%99%A8"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">电压调节器</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#132-%E7%94%B5%E6%BA%90%E7%AE%A1%E7%90%86"><span class="toc-number">1.3.2.</span> <span class="toc-text">1.3.2| 电源管理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#pvd%E5%8F%AF%E7%BC%96%E7%A8%8B%E7%94%B5%E5%8E%8B%E6%A3%80%E6%B5%8B%E5%99%A8"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">PVD (可编程电压检测器)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#133-%E4%BD%8E%E5%8A%9F%E8%80%97"><span class="toc-number">1.3.3.</span> <span class="toc-text">1.33| 低功耗</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%8E%E5%8A%9F%E8%80%97%E6%A8%A1%E5%BC%8F%E4%B8%8B%E7%9A%84awu"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">低功耗模式下的 AWU</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-%E5%A4%8D%E4%BD%8D%E5%92%8C%E6%97%B6%E9%92%9F%E6%8E%A7%E5%88%B6"><span class="toc-number">1.4.</span> <span class="toc-text">1.4| 复位和时钟控制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#141-%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%BD%8D"><span class="toc-number">1.4.1.</span> <span class="toc-text">1..4.1| 系统复位</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#142-%E7%94%B5%E6%BA%90%E5%A4%8D%E4%BD%8D"><span class="toc-number">1.4.2.</span> <span class="toc-text">1.4.2| 电源复位</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#143-%E6%97%B6%E9%92%9F%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.4.3.</span> <span class="toc-text">1.4.3| 时钟类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#hes%E6%97%B6%E9%92%9F"><span class="toc-number">1.4.3.1.</span> <span class="toc-text">HES 时钟</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#hsi-%E6%97%B6%E9%92%9F"><span class="toc-number">1.4.3.2.</span> <span class="toc-text">HSI 时钟</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lse-%E6%97%B6%E9%92%9F"><span class="toc-number">1.4.3.3.</span> <span class="toc-text">LSE 时钟</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lsi-%E6%97%B6%E9%92%9F"><span class="toc-number">1.4.3.4.</span> <span class="toc-text">LSI 时钟</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#css"><span class="toc-number">1.4.3.5.</span> <span class="toc-text">CSS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#rtc%E6%97%B6%E9%92%9F"><span class="toc-number">1.4.3.6.</span> <span class="toc-text">RTC 时钟</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E6%97%B6%E9%92%9F"><span class="toc-number">1.4.3.7.</span> <span class="toc-text">系统时钟</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%B6%E9%92%9F%E8%BE%93%E5%87%BA"><span class="toc-number">1.4.3.8.</span> <span class="toc-text">时钟输出</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#15-dma"><span class="toc-number">1.5.</span> <span class="toc-text">1.5| DMA</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#151-dma%E5%A4%84%E7%90%86"><span class="toc-number">1.5.1.</span> <span class="toc-text">1.5.1| DMA 处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#152-%E4%BB%B2%E8%A3%81%E5%99%A8"><span class="toc-number">1.5.2.</span> <span class="toc-text">1.5.2| 仲裁器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#153-%E5%AE%9E%E4%BE%8B"><span class="toc-number">1.5.3.</span> <span class="toc-text">1.5.3| 实例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#16-gpio"><span class="toc-number">1.6.</span> <span class="toc-text">1.6| GPIO</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#161-%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.6.1.</span> <span class="toc-text">1.6.1| 工作模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E5%90%91"><span class="toc-number">1.6.1.1.</span> <span class="toc-text">单向</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%8C%E5%90%91"><span class="toc-number">1.6.1.2.</span> <span class="toc-text">双向</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E6%8B%9F%E4%BF%A1%E5%8F%B7%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA"><span class="toc-number">1.6.1.3.</span> <span class="toc-text">模拟信号输入输出</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#162-io%E7%9A%84%E8%BF%9E%E6%8E%A5"><span class="toc-number">1.6.2.</span> <span class="toc-text">1.6.2| IO 的连接</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E5%90%91%E4%BC%A0%E8%BE%93"><span class="toc-number">1.6.2.1.</span> <span class="toc-text">单向传输</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%8C%E5%90%91%E6%8F%A1%E6%89%8B"><span class="toc-number">1.6.2.2.</span> <span class="toc-text">双向握手</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#163-%E9%87%8D%E6%98%A0%E5%B0%84"><span class="toc-number">1.6.3.</span> <span class="toc-text">1.6.3| 重映射</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E6%98%A0%E5%B0%84%E5%92%8C%E5%A5%BD%E5%A4%84"><span class="toc-number">1.6.3.1.</span> <span class="toc-text">重映射和好处</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E6%98%A0%E5%B0%84%E7%9A%84%E6%AD%A5%E9%AA%A4"><span class="toc-number">1.6.3.2.</span> <span class="toc-text">重映射的步骤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B"><span class="toc-number">1.6.3.3.</span> <span class="toc-text">实例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#164-sdio"><span class="toc-number">1.6.4.</span> <span class="toc-text">1.6.4| SDIO</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE"><span class="toc-number">1.7.</span> <span class="toc-text">参考文献</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li class="active"><a href="/embed-system/MCU%E4%B8%8E%E5%B5%8C%E5%85%A5%E5%BC%8F-%E5%9F%BA%E7%A1%80%E6%A6%82%E7%8E%871/" rel="bookmark" title="01| MCU与嵌入式:基础概率">01| MCU与嵌入式:基础概率</a></li><li><a href="/embed-system/%E7%AE%80%E5%8D%95MCU%E8%AF%BE%E8%AE%BE%E5%BC%80%E6%BA%90--%E7%94%B5%E5%AD%90%E9%92%9F/" rel="bookmark" title="简单MCU课设开源--电子钟">简单MCU课设开源--电子钟</a></li><li><a href="/embed-system/ARM_Architecture/" rel="bookmark" title="ARM-Architecture">ARM-Architecture</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Junwide Xiao" data-src="/images/avatar.jpg"><p class="name" itemprop="name">Junwide Xiao</p><div class="description" itemprop="description">生活与技术</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">25</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">6</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">24</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL2p1bndpZGU=" title="https:&#x2F;&#x2F;github.com&#x2F;junwide"><i class="ic i-github"></i></span> <span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29t" title="https:&#x2F;&#x2F;www.zhihu.com"><i class="ic i-zhihu"></i></span> <span class="exturl item weibo" data-url="aHR0cHM6Ly93ZWliby5jb20=" title="https:&#x2F;&#x2F;weibo.com"><i class="ic i-weibo"></i></span> <a href="https://junwide.github.io/about" title="https:&#x2F;&#x2F;junwide.github.io&#x2F;about" class="item about"><i class="ic i-address-card"></i></a> <span class="exturl item email" data-url="bWFpbHRvOmp1bndpZGVAb3V0bG9vay5jb20=" title="mailto:junwide@outlook.com"><i class="ic i-envelope"></i></span> <span class="exturl item youtube" data-url="aHR0cHM6Ly95b3V0dWJlLmNvbQ==" title="https:&#x2F;&#x2F;youtube.com"><i class="ic i-youtube"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/normal-Skill/Remote%20Work/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/embed-system/%E7%AE%80%E5%8D%95MCU%E8%AF%BE%E8%AE%BE%E5%BC%80%E6%BA%90--%E7%94%B5%E5%AD%90%E9%92%9F/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/theme-shoka-doc/" title="分类于 博客">博客</a></div><span><a href="/theme-shoka-doc/display/" title="Step.3 界面显示">Step.3 界面显示</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/theme-shoka-doc/" title="分类于 博客">博客</a></div><span><a href="/theme-shoka-doc/dependents/" title="Step.1 依赖插件">Step.1 依赖插件</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/theme-shoka-doc/" title="分类于 博客">博客</a></div><span><a href="/theme-shoka-doc/config/" title="Step.2 基本配置">Step.2 基本配置</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Program/" title="分类于 编程技术">编程技术</a></div><span><a href="/Program/SWDevelopmentSkill/" title="SW Development Skill">SW Development Skill</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/normal-Skill/" title="分类于 其他技巧">其他技巧</a></div><span><a href="/normal-Skill/Google_%E6%90%9C%E7%B4%A2%E6%8C%87%E5%8D%97/" title="谷歌搜索技巧">谷歌搜索技巧</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/normal-Skill/" title="分类于 其他技巧">其他技巧</a></div><span><a href="/normal-Skill/Git_%E7%9A%84%E6%97%A5%E5%B8%B8%E4%BD%BF%E7%94%A8/" title="Git 的日常使用">Git 的日常使用</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/linux-basic/" title="分类于 Linux基础">Linux基础</a></div><span><a href="/Linux-Basic/UPBoard%20%E4%BC%98%E5%8C%96%E4%BF%AE%E5%A4%8D%E6%8C%87%E5%8D%97/" title="UPBoard 优化修复指南">UPBoard 优化修复指南</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/normal-Skill/" title="分类于 其他技巧">其他技巧</a></div><span><a href="/normal-Skill/Latex%E6%95%B0%E5%AD%A6%E5%85%AC%E5%BC%8F%E8%A1%A8%E8%BE%BE%E4%BB%A5%E5%8F%8A%E5%85%B6%E4%BB%96MD%E5%BD%A2%E5%BC%8F/" title="Latex数学公式表达以及其他MD形式">Latex数学公式表达以及其他MD形式</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/linux-basic/" title="分类于 Linux基础">Linux基础</a></div><span><a href="/Linux-Basic/Kernel%20Module%20%E2%80%94%20Char%20Device%20Basic%20II/" title="Kernel Module — Char Device Basic II">Kernel Module — Char Device Basic II</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/theme-shoka-doc/" title="分类于 博客">博客</a></div><span><a href="/theme-shoka-doc/special/" title="Step.4 主题特殊功能">Step.4 主题特殊功能</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2021</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Junwide Xiao @ Brain Home</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">140k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">4:14</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"embed-system/MCU与嵌入式-基础概率1/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,copy_tex:!0,katex:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html>